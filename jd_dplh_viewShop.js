/*
活动名称：大牌联合浏览豆专用
环境变量：jd_dplh_viewShop_ids // 活动ID 多个用, @ 换行分割
        jd_dplh_viewShop_threads // 控制并发线程数（正整数），默认1，最大10，尽量使用默认值，否则请开启代理运行
        jd_dplh_viewShop_interval // 自定义运行间隔时长（整数，单位毫秒），默认1000
        jd_dplh_viewShop_notify // 是否推送通知（true/false），默认不推送
        jd_dplh_viewShop_pinFilter // 账号pin过滤，多个用@进行分割

高并发脚本，谨慎使用并发
活动限制IP严重，建议使用代理

cron:1 1 1 1 *

*/

const $ = new Env('大牌联合浏览豆专用')
var iｉl='jsjiami.com.v7';const iilll=iii1II;(function(liiI1l,i1l1II,i1ill,I1l11l,lilIIi,i1l1Il,llIli){return liiI1l=liiI1l>>0x7,i1l1Il='hs',llIli='hs',function(i1i11l,i1i11i,II11l1,Iil1lI,IiiliI){const iIIiii=iii1II;Iil1lI='tfi',i1l1Il=Iil1lI+i1l1Il,IiiliI='up',llIli+=IiiliI,i1l1Il=II11l1(i1l1Il),llIli=II11l1(llIli),II11l1=0x0;const iii1iI=i1i11l();while(!![]&&--I1l11l+i1i11i){try{Iil1lI=-parseInt(iIIiii(0x1b9,'DqA@'))/0x1+-parseInt(iIIiii(0x1dd,'^#hu'))/0x2*(-parseInt(iIIiii(0x271,'Exu!'))/0x3)+parseInt(iIIiii(0x1b3,'jPIq'))/0x4*(-parseInt(iIIiii(0x24c,'IU!B'))/0x5)+-parseInt(iIIiii(0x274,'P@36'))/0x6+-parseInt(iIIiii(0x165,'DqA@'))/0x7*(-parseInt(iIIiii(0x257,'ZF!O'))/0x8)+-parseInt(iIIiii(0x231,'Q2BU'))/0x9*(-parseInt(iIIiii(0x1d6,'wDzU'))/0xa)+parseInt(iIIiii(0x186,'vIuW'))/0xb;}catch(llIll){Iil1lI=II11l1;}finally{IiiliI=iii1iI[i1l1Il]();if(liiI1l<=I1l11l)II11l1?lilIIi?Iil1lI=IiiliI:lilIIi=IiiliI:II11l1=IiiliI;else{if(II11l1==lilIIi['replace'](/[AgGuJTLnFRCrIMBVwXWQK=]/g,'')){if(Iil1lI===i1i11i){iii1iI['un'+i1l1Il](IiiliI);break;}iii1iI[llIli](IiiliI);}}}}}(i1ill,i1l1II,function(il1iII,iilli,IlllIl,II11lI,lI1IIi,I1l11I,Ilil1l){return iilli='\x73\x70\x6c\x69\x74',il1iII=arguments[0x0],il1iII=il1iII[iilli](''),IlllIl=`\x72\x65\x76\x65\x72\x73\x65`,il1iII=il1iII[IlllIl]('\x76'),II11lI=`\x6a\x6f\x69\x6e`,(0x16beb1,il1iII[II11lI](''));});}(0x5f00,0x988e7,Iii11l,0xc0),Iii11l)&&(iｉl=0xc0);const jdCookie=require('./jdCookie'),common=require(iilll(0x1e8,'*FJP')),notify=require('./utils/Rebels_sendJDNotify'),getToken=require(iilll(0x265,'x0F&')),CryptoJS=require(iilll(0x20c,'ELj)'));console['log'](''),console['log'](iilll(0x16d,'^#hu')+$[iilll(0x1ba,'w&Gq')]+iilll(0x25a,'^#hu')),console['log'](iilll(0x1ee,'GJP0')),console['log'](iilll(0x1a1,'GJP0')),console['log'](iilll(0x14a,'By%J')),console[iilll(0x221,'21JO')]('jd_dplh_viewShop_notify\x20//\x20是否通知(true/false)，默认不推送'),console[iilll(0x171,'ocPN')](iilll(0x18b,'jIng')),console[iilll(0x251,'$G$i')]('=========='+$[iilll(0x26a,'L5Um')]+'提示结束=========='),console[iilll(0x184,'9b#L')]('');const dplhIdList=(process[iilll(0x1f0,'P@36')][iilll(0x21b,'m[*2')]||'')[iilll(0x1a7,'IU!B')](/[,@\n]+/g)[iilll(0x157,'21JO')](IiI1l=>IiI1l[iilll(0x1e1,'r2kd')]())[iilll(0x1c2,'$G$i')](Boolean);let taskThreads=process[iilll(0x189,'FgFu')]['jd_dplh_viewShop_threads']||'1';const runInterval=process['env']['jd_dplh_viewShop_interval']||iilll(0x22a,'x0F&'),isNotify=(process[iilll(0x18e,'klmo')][iilll(0x224,'5gnC')]||process['env'][iilll(0x1da,'CM0f')])===iilll(0x1f6,'jT&h'),pinFilter=(process[iilll(0x18e,'klmo')]['jd_dplh_viewShop_pinFilter']||'')[iilll(0x213,'Q2BU')]('@');function iii1II(_0x1d8cc7,_0x3cd6c0){const _0x1459ff=Iii11l();return iii1II=function(_0x4859f8,_0xb990f4){_0x4859f8=_0x4859f8-0x142;let _0x4cd2b2=_0x1459ff[_0x4859f8];if(iii1II['SNVkKY']===undefined){var _0xcf17fc=function(_0xc42f0){const _0x379743='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3612a6='',_0x30e9fa='';for(let _0x1dc9ea=0x0,_0x47ffdf,_0x5cee09,_0x274d00=0x0;_0x5cee09=_0xc42f0['charAt'](_0x274d00++);~_0x5cee09&&(_0x47ffdf=_0x1dc9ea%0x4?_0x47ffdf*0x40+_0x5cee09:_0x5cee09,_0x1dc9ea++%0x4)?_0x3612a6+=String['fromCharCode'](0xff&_0x47ffdf>>(-0x2*_0x1dc9ea&0x6)):0x0){_0x5cee09=_0x379743['indexOf'](_0x5cee09);}for(let _0x4ebf43=0x0,_0x49eb12=_0x3612a6['length'];_0x4ebf43<_0x49eb12;_0x4ebf43++){_0x30e9fa+='%'+('00'+_0x3612a6['charCodeAt'](_0x4ebf43)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x30e9fa);};const _0x95bba1=function(_0x591154,_0x1c8aa6){let _0x470516=[],_0x1dde36=0x0,_0x4eafd0,_0x122bef='';_0x591154=_0xcf17fc(_0x591154);let _0x20b6db;for(_0x20b6db=0x0;_0x20b6db<0x100;_0x20b6db++){_0x470516[_0x20b6db]=_0x20b6db;}for(_0x20b6db=0x0;_0x20b6db<0x100;_0x20b6db++){_0x1dde36=(_0x1dde36+_0x470516[_0x20b6db]+_0x1c8aa6['charCodeAt'](_0x20b6db%_0x1c8aa6['length']))%0x100,_0x4eafd0=_0x470516[_0x20b6db],_0x470516[_0x20b6db]=_0x470516[_0x1dde36],_0x470516[_0x1dde36]=_0x4eafd0;}_0x20b6db=0x0,_0x1dde36=0x0;for(let _0x196bad=0x0;_0x196bad<_0x591154['length'];_0x196bad++){_0x20b6db=(_0x20b6db+0x1)%0x100,_0x1dde36=(_0x1dde36+_0x470516[_0x20b6db])%0x100,_0x4eafd0=_0x470516[_0x20b6db],_0x470516[_0x20b6db]=_0x470516[_0x1dde36],_0x470516[_0x1dde36]=_0x4eafd0,_0x122bef+=String['fromCharCode'](_0x591154['charCodeAt'](_0x196bad)^_0x470516[(_0x470516[_0x20b6db]+_0x470516[_0x1dde36])%0x100]);}return _0x122bef;};iii1II['QGhccj']=_0x95bba1,_0x1d8cc7=arguments,iii1II['SNVkKY']=!![];}const _0x2a6cc8=_0x1459ff[0x0],_0x478962=_0x4859f8+_0x2a6cc8,_0x3bb7f8=_0x1d8cc7[_0x478962];return!_0x3bb7f8?(iii1II['GAOBMC']===undefined&&(iii1II['GAOBMC']=!![]),_0x4cd2b2=iii1II['QGhccj'](_0x4cd2b2,_0xb990f4),_0x1d8cc7[_0x478962]=_0x4cd2b2):_0x4cd2b2=_0x3bb7f8,_0x4cd2b2;},iii1II(_0x1d8cc7,_0x3cd6c0);}interaction=[];let cookiesArr=Object[iilll(0x20f,'r2kd')](jdCookie)[iilll(0x191,'nOw3')](illlII=>jdCookie[illlII])[iilll(0x164,'CS%C')](iIII11=>iIII11);!cookiesArr[0x0]&&($[iilll(0x1ef,'#8lh')]($['name'],iilll(0x1be,'21JO')),process['exit'](0x1));!(async()=>{const il1iI1=iilll,IiI1i={'aMVCx':function(llll1){return llll1();}};notify[il1iI1(0x258,'m[*2')]({'title':$[il1iI1(0x187,'vIuW')]}),await IiI1i[il1iI1(0x1e5,'N(dT')](Main),isNotify&&notify[il1iI1(0x249,'P@36')]()&&await notify[il1iI1(0x22e,'N(dT')]();})()[iilll(0x25b,'zq@[')](lil11l=>$[iilll(0x155,'P@36')](lil11l))[iilll(0x21e,'klmo')](()=>$['done']());function Iii11l(){const i1ilI=(function(){return[...[iｉl,'MFBjKJAsCRIjVVIiwnQaXRJmrig.cuTomW.LMv7G==','aSkuW5nDCa','8y+9NrJLHzROR6Ga','js3cJtRdJxy','4P+wW4NOH4dMNkFOV6FOOApPGkRLI4dKU4BPLPBORiG4','W77cGfy','W73cHSk1B0rHgmkDcCoR','WROQW5ZdT8oWpSozWRurW7lcR8oX','W5pcLmoZA8o/','vCoQju4g','bMxcOCkgEG','WOldJ1iDDmkSWQO1W5NcUrNcGxeNWR/cRa','W6murG','oSkwWP1TCG','WOpcIwldHLy','W6pcJMBcNem','W7FcQmkXyNO','qmkteh7cVmodCYddS8o+xf8t','jYNcKXuZWQ8','W7lcHq0Dm0ynW5pcIJm','FSo0A8kXWP8','WRpORjBMSAtLKkRLUlldQW','p8oup2/cPq','4PIrWRVOHQtLRzJKURVOV6/OOQ7PLRpPMR/MLAlPLyZORzlNV5BPLz3ORyy','v8k0vq','W4u2CCk5ta','oSoDW4e','WOZcPNpdV8opaSoFEHBcQq','B1zMWQm','WOVcU19/oIfip8o3ECoEWOC','WPNdVwCODG','WRFcMhu','4P2qh+ACQ+ECQoIUHoAYQ1K','WOZdQX0V','bCkeW7ri','WQldKLbdkW','oSkwWPpdVtfuWPq','CmkFW7DhW4K','W6JcPuFcVexdNXDHwmkgWQaoErFdNq','pSoUWR0OWOKeW7mJeKZdK1tdINvRW7HQ','WQtcSmofW4jXBMe','WQVdHuXBoHPaWQNcUreYWPuyd8ohWOldLMqLkJJdMuXdWPRcOWNdVCk3o1/dNmoJEWC1xq','WQJdIwb8bq','g8oQBCoYW6Oo','WR3cNwddHx8','WQFcMKFdJmoXjq','W5vXhCo5uWBcJq','gmoYFmoW','wmoOW6xcPa','WOyqW6ldVSox','WO/dKeu','W6WlEZlcPMRdPmky','pSkvWOhdIeP6WQSFW6G/wvJdLq','zSogW5VcLq','BNWb','W7P+Cq','W63cG3FcPNS','WRZcVwFdH2lcLCoMW6/dHtdcHCkvW7egb8o5W6hdQqDtW5/cJNKLWOiPW5H7cmoR6lAN5y25WQVdQ8oc6lYb5RMt772j5AEx5lQ955wsWPZOVQlOO7xLIOJLIlG','kSoDuCoJW5i','Ad01','W6dcJ8ox','W6JcQuFcVe3dLXW','WOtdPq4','q8o9iW','WRddMvDBbuKCW7i','rCkrehy','A8oTA8kSWO7cSW','mapcSZNdUG','W7ZdKr7cKSkO','WQldKKXcp0KBW7/cMHW','W5L1cmo8','aCo2n3NcKbCRWRmyW7NcU2JdP24GW7vdWRNcJuyyrIbvW6mEWRK','W57cVf9/o3bmFSoYq8kJW7m','gb1dW6W','WRlcUeZdGG','fLK9','WOdcNeZdS8or','bCoGzW','zxWkW7HSW7qiWRSTWPSFbNhdUrBcU1q','W5hcHSk2eCoGeXVdPs5wDtrsDNJcGK9Pr8kckCoaW6LEW5mxb2xMJkFLI6JLU5JLJAVNUkBNQQFMLkdVV4JPUAFORO/cIo+9KoAFKUwLHmoUqq','oSoPWQ03WPupW7Gz','WPRdRWqVFc4','W7n/ya','W7RdJXVcKSk8FmocWRu','hCkwWPHFz8opEmoK','smkRxSoSgW','lsxcKqyIWRu','sIy/hSko','uCkff38','t8onWPXMvmo6w8og','mJtcJqG4WRPGW4jy','WQtcVeJdJ3pcMSoR','W64luCk+BHhcLdhdMX0yW7RdPxhcTSoWb8oFWOBdMw7cHSorWRBdISkdWPtcQSkFs0O','eYHTW4D8','WOpcTx4','oZFcHdRdKwa','WQ3cLLe','mciWWPtdP2ua','BSoIgvOvWODP','W6GSrSkQxW','hCoWFmo4W6tcRMeGW5e5','W4ddRYtcImk6','WQZcLe/dGNW'],...(function(){return[...['W7RcGqGsFbCQW6VcNI84WRa','CCklW6Le','uvX3WOuf','WRNdMrvijW','B8klW7zaW5ldIW','44kd5OYX56sC44o26k2r5yAd6i+35y20WPhdQc5DWQFcPG','WRVcSeVdKhVcLSoG','m8kIW6HJCa','kmkyeSksE17cVCoD','W4f1WOGLrte','W6VcKrfEWRC','n8oMWRO6','y1CbW51s','n8oJW6/dHXm','W6zOWP7cOCk3rmo5WQSVW4tcRmow','W6a05lQh5yI8pa','WRPsWP/dJ8k9W7myWORdO0RdNbZdVCohW4vZW60','ouZcIa','jYFcJXVdRwehWPbCW6X/WRZdGSoyrNPWoSkRqqW','WQNdN8kIF3PEhmkh','W5ZdSJ3cSCkBumkmbf7dP0FcG8oviCoB','hLGOWQ9OW64fAdlcRCoorW','WQRcRtK','W6lcNtvoWRRcHSkwWQS6nL56WPDlyhK','W5ZcGCkZgSo1','WRm9W4ddV8o2gW','nCogW5NdTJRdSSkglSkWthJcI1ZcU8oncNddTSkJWPTI','iCoIWR43WOeiW7G','rCo5nKpdKH8PWPKpW64','tbXVW7KSWPmzvthcPCoMzW','8jIPGCkK','p8oOWQK','W6NcJSog','W5DWi8o5rHJcLSotW77cGCoiqHNcMra4WO5iWPvyWQPBWRq','WRbbWOxdJmo4WRWs','W7FdTMVcOx3dTSoPWQynFq','WOdcRYtcMmkvA8kYdG','xIWNoCk2W53dUmknWQ8iWOZdLtfs','zteMWPxdO2uGW5pcKHK','yva+W6zX','W7Sjsmk/','W4BdUIFcTG','ASoNxCk3WO4','mINcMa8','FxjxWO4l','WOBcLMVdTW','pSo1W7ZdGq','FCkOWRSVWOKhW65flL/dMexdG0PDW6f6umkkfmoyy28','jJFcMrNdIq','W5aTxcFcHq','s8kzcNdcRCopAt7dHSoXqHmEW77dLW7cISkwWPmogCoFESkkW4WoFZS+','WP/cRxpdHCoG','pCkzbq','W5hcHSk2eCoGeXVdPs5wDtrsDNJcGK90s8kdBmkoWQin5REi5yQqyqhcOowNHos6HoEwKSk1WOWqW6tMJ53OOAFLIR/LIk4','dmkwW6C','lcZcNa','j8onW5lcUHmHW7eTW5apsNVdICkRuwpcOZXDB8kpWRNcNJu6hSkAyN3dGmkHz1ldS8o0qSoy','WRm3W4K','W6XJkmoFrq','ldnKW5K','6lAB5y+J5PAC5PEv','WR/cJvZdJG','W6tcR0dcHKG','WRtdKffFhuKcW6m','iCoIWQm6WPia','xSkPqmoQhq','WR/cUfVdQvy','W7lcGLlcJSoqWQi0W5VcJCoRlLFcQG','uxS0','kSkmWPldLdPr','cSkwWRPtrmolEComWOBcQSoT','W58cvmkluq','kSoGW5FdKcPJ','puBcJSkxD8ouxW','W4jUWPy+uG4NWPhcStxcJmoi','ASoRAmk8WPJcJ8oilCk6WQS','5BEC6kYI57Y96lEa6lY46l6U6kcj5B6J5yI06lAT5yYO','W6dcLvtcJSoiWQWPW4tcQW','W4ddGmk1WOvzWRSb','bJfaW6X7','WOtcG8oJW58kW7GldmkCy0NcTa','fYhcSayS','WQBcLLRdMmoSiSkBW5dcRCkKmG','lSodjfBcNCk0W5D1wG','W73KUilMT43LIjFcMW','W7BcJdnUWRRcJCkwWQmM','W6qEwmkH','omk7pmkhqW','WR3cSmoBW5rlDw7cJmoF','aXFcUXCZ','uSkach7cVG','vHGEkmku','ESojW5RcTqq','i8ouoelcU8k+WPDWx8kRwshcVNzpkvtdISoIvHm','A8kdW6LeW6ZdJgVcGhu','mZxcKsq4WRK','m8kyWPvYxG','W6hcGmovyW','W6/cNb5JWQtcHSkxWPOPhfrJWRbgyx3dS8kFCCoF','W77cImkUAG','W7iEyZFcSb/cRq','W6pcImopy8oCWOnz','WOyVW4NdKmoq','nCoUWRy'],...(function(){return['W7/cJKe','WRRcRCoxW4vTCG','emoOW5JdQXi','WRDmWQNdM8oHWR8uWRddS0/dMb/dI8kdWOPHW4ddM0WOrCobWPq','CZm7WOJdGwu5W48','p8kAWQBdVJe','w3Pv','oCkDWPhdMYDAWPq','WRhcOZFdOW','orrPWQi','mY7cKYqU','WQddKeWfEmkHWR9SW6tcRWFdIW','emo2zSo2W6BcRW','BePYWQu','WPz+WOBdLmoi','eCkijmkkCq','eSoghgpcH8oBDI4','W4WutSk5BHC','W6efyW7cMq','WQ5aWPNdJ8oDWROpWPS','W60owmk3DtZcNcBdMq','W7HFuSo4WQi','W6GqAa','iCoum0hcNCkZ','WQhdT01Xdq','WRVcSeVdKhVcLSoGW6tdIINcHq','CSkdW7DsW5BdL2q','f8oNbu3cHW','BNWvW79GW6K','W6FcTCohCmoY','yCojW5xcNaKSW7OD','W5WjEXhcHG','hSoUACoNW4WmWOldJa','v3HGWPKu','jmoFpKRcNmk/WP9S','WRTbWO4','f0u9','hCoYk3xcKq','W689DXtcGG','uCkUwSoPgq','lIFcNJldMNCzWP5nW6W','zSoOc3hcJa','W49HeSoywba','dCoTbmk0wSoQtmktsmkHfJG','W6FcQ2/cQ8oq','WR9DWO/dMSoJWP0vWOZdRG','dum/WRDjW4SpAW','oCkkWO/dUdnB','W4TZWOm','kJdcJX7dI2e','WRRcTL8','W7BcHSk9','nmowW4/dTb4','ELe3W5D+tW','ASoaW4/cOgzqWObXgSoTdq','W6BcLY9HWR3cJq','W6NcHmopzCoeWOC','5y2P6ywu6k665PUmW48cW596fSkPdSorWOv5','oCo1W7ZdGYS','4PYFWQFMN6tOGQBMROpNOixLPPNNKAXC','Bmo+gu8k','CvzYWR4AWOyx','ACoeW4lcUrG','eddcGHRdMW','x8k6rSoK','W57dNmkLWPvvWQCC','kZy/W5pdS347W4tcR1ldQmk1WPBcMSo1rCoLjSk9lCoEgx/dLmo6W7ScW4ldTCoTWOnfgmovmCoNcmo9W5VcMCoVwCoEWR7cNLG','nmoKWPq0WOu','jGSSW6z5r0yjaYZdJCkXESkoW4VcLdRcMrBdGa','8lY+LWhLV5lLP4XsWQ4','pmkve8k3DG','W5RcJ1xcK8od','4P2eWOFMNPZOGi3MRj/NOkBLPPVNKAJcKq','WQFcUmoBW5q','W6BdTmkUWRnE','imoVWQeRWQWcW64E','WPddI0mfAmk8','BSo4dq','amo3WRWIWOC','uSkyc2FcHSodDc0','mmk4wbXeW5TnW4HgcxhdGG','W63cISkIpCoQ','z8oQhKG','FxFdMuJcIZXsWQXjW7TpWOldGq','WOdcUhFdHgG','WRiCBhFcStlcR8kpudP9D8kyaSoadfVcQ8kaWPNdHCketmk+WOlcTHWrWRBcS1v8','amkwW7natui','F8ogW5/cHcGHW7il','W69LDmoO','WRFcKNWCW6JdRq','dmkCWOzzuSoA','W45GhCoPqWC','44gl6lEw5y6k','BmomW4/cPManW4jQomo3gSk8la','W64BucBcPtZcO8oOh2mOzCo/wCkBhJ3dTSknW5NdGSkswmoVWO3cPWunWQlOHAhLRQRKUzhOVPJOOAdPL5JPM7ZMLOxPLyNVVRNPUP7ORz5MW6PCpq','W4ZcG8kaaq','emk2WO/dUZG','BeuTW7m','WQRdT1rBoG','W5RcS1P/pcbttSoxCSkm','yxSAW6DWW78dWOe','WRddHfb6pG','6lwD5y+D5PA65PAi'];}())];}())];}());Iii11l=function(){return i1ilI;};return Iii11l();};async function Main(){const IlllIi=iilll,i1i1Il={'DoYAS':function(I1lIl1,lil11i){return I1lIl1(lil11i);},'qtjJH':'2.0','tJILv':IlllIi(0x1f4,'BJ5E'),'xhCEn':function(IlIIl,lI1liI){return IlIIl>lI1liI;},'FcBei':function(i1i1Ii,lllii){return i1i1Ii(lllii);},'ezlLL':function(iI11Ii,iIII1l){return iI11Ii>iIII1l;},'LGToL':function(lllil,iI11Il){return lllil!==iI11Il;},'mwggP':function(iIII1i,iil1i1){return iIII1i===iil1i1;},'HtXBs':function(il1i11,IlIll1){return il1i11(IlIll1);},'iacJD':'OOjzH','Inste':IlllIi(0x1ec,'jT&h'),'GiERD':IlllIi(0x17c,'DqA@'),'VuRiO':function(IlIII,ilil1l){return IlIII<ilil1l;},'kxzgR':function(illlIi,I1lIii){return illlIi===I1lIii;},'XvtSS':'5|7|2|4|1|3|6|0','joXGT':function(IiI1I,illlIl){return IiI1I!==illlIl;},'ULGXR':function(i11ill,IIIIIi){return i11ill-IIIIIi;},'UPZeD':function(IIIIIl,I1lIil){return IIIIIl===I1lIil;}};try{if(i1i1Il[IlllIi(0x1c6,'zq@[')](dplhIdList['length'],0x0)){console[IlllIi(0x184,'9b#L')]('⚠\x20请先定义必要的环境变量后再运行脚本');return;}const IIIl1i=[...new Set(dplhIdList)];try{const liiII1=i1i1Il[IlllIi(0x24a,'nOw3')](parseInt,taskThreads);liiII1>0x0&&liiII1!==0x1&&(taskThreads=liiII1);}catch{taskThreads=0x1;}taskThreads=Math['min'](taskThreads,0xa),$[IlllIi(0x1f8,'DqA@')]=null;if(runInterval){if('cuiWv'===i1i1Il[IlllIi(0x1fb,'jIng')]){const lllll=i1i1Il['DoYAS'](IiiIil,{'actId':IiiIii,...IIlll,'method':liliI,'userId':ll1lI,'buyerNick':l1iii||''}),i11ili={'jsonRpc':i1i1Il[IlllIi(0x1b7,'^#hu')],'params':{'commonParameter':{'m':i1i1Il[IlllIi(0x24d,'21JO')],'oba':lllll[IlllIi(0x1e4,'CS%C')],'timestamp':lllll[IlllIi(0x211,'L5Um')],'userId':IIlli},'admJson':{'actId':l1iil,...ii1l1,'method':lIIill,'userId':I11iIi,'buyerNick':I1ilII||''}}};return i1i1Il['xhCEn'](I11iIl['indexOf'](IlllIi(0x179,'*FJP')),-0x1)&&delete i11ili[IlllIi(0x1bd,'w&Gq')][IlllIi(0x228,'ZF!O')][IlllIi(0x1f7,'g7GP')],i11ili;}else try{const iil1l1=parseInt(runInterval);iil1l1>=0x0&&($[IlllIi(0x241,'BE49')]=iil1l1);}catch{i1i1Il[IlllIi(0x268,'21JO')]===i1i1Il['GiERD']?ii1ll['assign'](IliI1l,lliiil):console[IlllIi(0x190,'lp9I')](IlllIi(0x169,'^#hu'));}}IIIl1i[IlllIi(0x22d,'@9Q1')]>0x0&&('lfCic'===IlllIi(0x195,'P@36')?llIllI[IlllIi(0x1cf,'jO0i')]('❓'+I1ilI1+'\x20'+iillll[IlllIi(0x20e,'m[*2')](lIIilI)):console[IlllIi(0x15e,'r2kd')](IlllIi(0x154,'DqA@')+IIIl1i[IlllIi(0x17f,'jT&h')]+IlllIi(0x20d,'5gnC')));for(let ill11i=0x0;i1i1Il[IlllIi(0x15a,'klmo')](ill11i,IIIl1i['length']);ill11i++){if(i1i1Il['kxzgR']('yNHKn','eBikK'))Illl1I['log'](lliiiI);else{const ill11l=i1i1Il[IlllIi(0x240,'By%J')][IlllIi(0x166,'h]cL')]('|');let I1lIiI=0x0;while(!![]){switch(ill11l[I1lIiI++]){case'0':$[IlllIi(0x1d3,'U88i')][IlllIi(0x259,'klmo')]>0x0&&(cookiesArr=cookiesArr[IlllIi(0x23d,'4k2X')]((lllili,IliiiI)=>!$['needRemoveCookieIndex'][IlllIi(0x150,'4k2X')](IliiiI+0x1)),$[IlllIi(0x216,'ELj)')]=[]);continue;case'1':$['hasPrintActInfo']=![];continue;case'2':console[IlllIi(0x16a,'IU!B')](IlllIi(0x266,'r2kd')+$[IlllIi(0x1df,'jPIq')]+IlllIi(0x1c8,'CM0f'));continue;case'3':$[IlllIi(0x1fe,'ZF!O')]=![];continue;case'4':await common[IlllIi(0x1a6,'m^ME')](taskThreads,cookiesArr,taskFnc);continue;case'5':$[IlllIi(0x1cb,'P@36')]=[];continue;case'6':i1i1Il['joXGT'](ill11i,i1i1Il['ULGXR'](IIIl1i[IlllIi(0x1d2,'4G0*')],0x1))&&console['log']('');continue;case'7':$[IlllIi(0x197,'DqA@')]=IIIl1i[ill11i];continue;}break;}}}}catch(Ill11){if(i1i1Il[IlllIi(0x160,'jIng')]('suhQw',IlllIi(0x151,'DqA@')))console[IlllIi(0x19f,'BE49')](IlllIi(0x156,'lf86')+Ill11);else{const li1i11=i1i1Il['FcBei'](IlI1I,II11Ii);i1i1Il[IlllIi(0x233,'By%J')](li1i11,0x0)&&i1i1Il[IlllIi(0x1a9,'3zQf')](li1i11,0x1)&&(IlI11=li1i11);}}}async function taskFnc(iI11I1,il1i1l){const iIIiil=iilll,IlIlll={'gFuQR':'⚠\x20请先定义必要的环境变量后再运行脚本','ZVXkn':iIIiil(0x26c,'*FJP'),'cqStZ':function(iil1ll,iiilil){return iil1ll!==iiilil;},'mIbhy':iIIiil(0x219,'m^ME'),'JMPkK':iIIiil(0x1bf,'jIng'),'rebIL':iIIiil(0x1ea,'By%J'),'pogLR':iIIiil(0x196,'^#hu'),'gOUxo':iIIiil(0x152,'wDzU'),'rnlEx':function(iil1li,lillIl,iIiIl){return iil1li(lillIl,iIiIl);},'iFlps':function(iiilii,li1i1i){return iiilii||li1i1i;},'itgta':iIIiil(0x199,'nOw3'),'CRQpJ':iIIiil(0x263,'jPIq'),'QwTBs':iIIiil(0x1bc,'DqA@'),'VaOgz':function(IlIli1,illIiI){return IlIli1===illIiI;},'kDXfm':iIIiil(0x227,'N(dT'),'cKAet':iIIiil(0x1b8,'jIng'),'gWgxX':iIIiil(0x22c,'9b#L'),'PCvSx':'jinggengjcq-isv.isvjcloud.com','McvHv':iIIiil(0x17b,'DqA@'),'YwgHR':function(lI1lli,Ill1l){return lI1lli<Ill1l;},'oTZJi':function(llI1Il,ii1iii){return llI1Il>ii1iii;},'KGaTg':'juhlv','KceXT':'SaWJE','SFNuh':iIIiil(0x170,'9b#L'),'VhKHz':function(i11iil,Ill1i){return i11iil>=Ill1i;},'DokQA':iIIiil(0x161,'g7GP'),'Yrhed':iIIiil(0x1b0,'^#hu'),'mAkiM':iIIiil(0x1a0,'4k2X'),'BWDve':'VgJVe','achhb':iIIiil(0x16f,'lp9I'),'gcZoe':function(ii1iil,lllI1l){return ii1iil(lllI1l);},'HOsjl':'%27','ousfv':function(i11iii,llI1Ii){return i11iii+llI1Ii;},'kBxVW':function(lllI1i,li1i1l){return lllI1i+li1i1l;},'SmNev':iIIiil(0x201,'zq@['),'PyuYV':function(II1i1,lI1lll){return II1i1-lI1lll;},'YHLfU':function(iIiII,iil1lI){return iIiII>iil1lI;},'aZcTx':iIIiil(0x176,'ZF!O'),'niPYc':iIIiil(0x1a5,'jT&h'),'KKdyz':iIIiil(0x1c0,'#8lh'),'UAxUb':'htPiu','bFuZD':iIIiil(0x163,'Q2BU'),'hOCiW':function(iiiliI,li1i1I){return iiiliI==li1i1I;},'ZxAku':function(illIii,ii1il1){return illIii+ii1il1;},'JxYhF':function(lI1llI,illIil,Ill1I){return lI1llI(illIil,Ill1I);}};if($[iIIiil(0x1b1,'P@36')])return{'runEnd':!![]};const IIIl1I=decodeURIComponent(common['getCookieValue'](iI11I1,IlIlll['SmNev'])),iil1ii=IIIl1I['substring'](0x0,0x2),IlIlli=IIIl1I['substring'](IlIlll[iIIiil(0x200,'r2kd')](IIIl1I[iIIiil(0x238,'ELj)')],0x2)),il1i1i=IlIlll[iIIiil(0x214,'3zQf')](IIIl1I[iIIiil(0x145,'ocPN')],0x4),lil111='*'[iIIiil(0x146,'m^ME')](il1i1i),i11ilI=IlIlll[iIIiil(0x255,'U88i')](iil1ii,lil111)+IlIlli,ii1ii1=iIIiil(0x148,'VuSc')+il1i1l+'】'+i11ilI+'：',llllI=notify[iIIiil(0x252,'P@36')](il1i1l,IIIl1I);if(IlIlll[iIIiil(0x183,'4G0*')](pinFilter[iIIiil(0x1a8,'CS%C')],0x0)&&(pinFilter[iIIiil(0x243,'ELj)')](IIIl1I)||pinFilter[iIIiil(0x23f,'vIuW')](IlIlll[iIIiil(0x226,'ZF!O')](encodeURIComponent,IIIl1I)))){llllI['fix'](iIIiil(0x205,'nOw3')),console['log'](llllI[iIIiil(0x1d0,'m[*2')]()),$['needRemoveCookieIndex']['push'](il1i1l);return;}const lllil1=await common['getLoginStatus'](iI11I1);if(!lllil1&&typeof lllil1===IlIlll['aZcTx']){console[iIIiil(0x1d9,'klmo')](ii1ii1+'账号无效'),llllI[iIIiil(0x188,'4k2X')](iIIiil(0x1f5,'CM0f')),$['needRemoveCookieIndex'][iIIiil(0x1aa,'Q2BU')](il1i1l);return;}const iil1il=common[iIIiil(0x267,'VuSc')](IIIl1I);let ilil1I='',i11il1=$[iIIiil(0x1b6,'@9Q1')],ii1iiI=IlIlll[iIIiil(0x1c3,'m[*2')],lllilI='',ilil11=iIIiil(0x1eb,'Q2BU'),illlI1=iIIiil(0x185,'By%J')+ilil11,IIIl11='',I1lIi1=![];lllilI=await getToken(iI11I1,illlI1),await $[iIIiil(0x1e2,'^#hu')](IlIlll[iIIiil(0x22b,'CS%C')](parseInt,IlIlll[iIIiil(0x177,'w&Gq')]($[iIIiil(0x241,'BE49')]*0x1,0x1f4),0xa));if(!lllilI){if(IlIlll[iIIiil(0x20a,'CS%C')](IlIlll[iIIiil(0x223,'U88i')],IlIlll[iIIiil(0x26b,'&9MI')]))I1llil=I1llii[iIIiil(0x21a,'klmo')][iIIiil(0x181,'@9Q1')]?.[iIIiil(0x178,'g7GP')]?.[iIIiil(0x235,'r2kd')];else return;}await IlIlll[iIIiil(0x1e3,'h]cL')](lil11I,IlIlll[iIIiil(0x239,'DqA@')]),await $['wait'](IlIlll['rnlEx'](parseInt,IlIlll[iIIiil(0x1c5,'4k2X')]($[iIIiil(0x225,'jPIq')]*0x1,0x1f4),0xa));if(IlIlll[iIIiil(0x18a,'g7GP')](ilil1I,''))return;if($[iIIiil(0x256,'x0F&')]||I1lIi1)return;$[iIIiil(0x1c1,'VuSc')]='',await IlIlll[iIIiil(0x264,'*FJP')](lil11I,IlIlll[iIIiil(0x23c,'ELj)')]),await $[iIIiil(0x229,'jO0i')](parseInt(IlIlll['ZxAku']($['waitTime']*0x1,0x1f4),0xa));if($[iIIiil(0x270,'Q2BU')])for(let lIli11 of $[iIIiil(0x192,'DqA@')]||[]){$[iIIiil(0x20b,'jT&h')]=iIIiil(0x24f,'wDzU'),$[iIIiil(0x158,'lf86')]=lIli11['userId'],await lil11I(iIIiil(0x23b,'w&Gq')),await $['wait'](parseInt(IlIlll[iIIiil(0x1e9,'P@36')]($['waitTime']*0x1,0x5dc),0xa));}if($[iIIiil(0x218,'CS%C')])return{'runEnd':!![]};await $[iIIiil(0x14b,'GJP0')](IlIlll[iIIiil(0x230,'VuSc')](parseInt,$['waitTime']*0x1+0x1f4,0xa));async function liiIIi(lllI1I,lillI1){const i1l1Ii=iIIiil;try{switch(lllI1I){case i1l1Ii(0x1fc,'21JO'):if(lillI1['success']&&lillI1[i1l1Ii(0x273,'Exu!')]?.['status']==0xc8)ilil1I=lillI1['data'][i1l1Ii(0x1e7,'zq@[')]?.[i1l1Ii(0x1cd,'^#hu')]?.[i1l1Ii(0x24e,'5gnC')];else lillI1[i1l1Ii(0x198,'CM0f')]?.[i1l1Ii(0x222,'L5Um')]==0x1f4?(console['log'](''+ii1ii1+lillI1[i1l1Ii(0x159,'4G0*')]),llllI[i1l1Ii(0x220,'*FJP')](''+lillI1['errorMessage']),I1lIi1=!![]):console['log']('❓'+lllI1I+'\x20'+JSON['stringify'](lillI1));break;case IlIlll['ZVXkn']:if(lillI1['success']&&lillI1[i1l1Ii(0x1e7,'zq@[')]?.['status']==0xc8)$['shopList']=lillI1?.[i1l1Ii(0x19c,'jIng')]?.[i1l1Ii(0x1c4,'*FJP')]||[];else lillI1['data']?.[i1l1Ii(0x147,'CM0f')]==0x1f4?console[i1l1Ii(0x253,'jIng')](''+ii1ii1+lillI1[i1l1Ii(0x203,'$G$i')]):IlIlll[i1l1Ii(0x153,'#8lh')](i1l1Ii(0x26f,'*FJP'),IlIlll['mIbhy'])?console[i1l1Ii(0x1f2,'4G0*')]('❓'+lllI1I+'\x20'+JSON[i1l1Ii(0x1ac,'CS%C')](lillI1)):IiiIl1[i1l1Ii(0x234,'5gnC')]=lIIil1?.[i1l1Ii(0x193,'Q2BU')]?.[i1l1Ii(0x21c,'lf86')]||[];break;case IlIlll[i1l1Ii(0x16b,'r2kd')]:if(lillI1['success']&&lillI1[i1l1Ii(0x19b,'BJ5E')]?.['status']==0xc8)$[i1l1Ii(0x1b4,'Exu!')]=lillI1?.[i1l1Ii(0x14d,'x0F&')]?.['data'],console[i1l1Ii(0x254,'lf86')](''+ii1ii1+(lillI1[i1l1Ii(0x26e,'Exu!')]||$[i1l1Ii(0x262,'&9MI')]?.[i1l1Ii(0x1f9,'*FJP')]||'')),llllI[i1l1Ii(0x244,'5gnC')](''+(lillI1[i1l1Ii(0x26e,'Exu!')]||$[i1l1Ii(0x1db,'5gnC')]?.[i1l1Ii(0x17d,'BE49')]||''));else{if(lillI1[i1l1Ii(0x173,'lp9I')]?.[i1l1Ii(0x26d,'9b#L')]==0x1f4){if(IlIlll[i1l1Ii(0x168,'ELj)')]===IlIlll['pogLR']){IiilI1[i1l1Ii(0x1a4,'FgFu')](IlIlll['gFuQR']);return;}else console[i1l1Ii(0x245,'wDzU')](''+ii1ii1+lillI1[i1l1Ii(0x1ce,'wDzU')]);}else console[i1l1Ii(0x1ca,'iyFG')]('❓'+lllI1I+'\x20'+JSON[i1l1Ii(0x206,'21JO')](lillI1));}break;}}catch(liil11){console['log'](i1l1Ii(0x25c,'*FJP')+lllI1I+i1l1Ii(0x167,'21JO')+(liil11['message']||liil11));}}async function lil11I(iiillI){const I1iIIi=iIIiil;if($[I1iIIi(0x24b,'CM0f')])return;let l1l111=illlI1,l1iIII=null,llI1I1=null,IlIlil=I1iIIi(0x1e6,'jIng');switch(iiillI){case'activity_load':l1l111+='/dm/front/jdJoinCardtf/activity/load',llI1I1={'open_id':'','mix_nick':ilil1I||'','user_id':ii1iiI},l1iIII=IlIlll[I1iIIi(0x215,'vIuW')](Iliii1,'/jdJoinCardtf/activity/load',Object['assign']({'jdToken':lllilI,'source':'01','inviteNick':IlIlll['iFlps'](IIIl11,'')}));break;case'shopList':l1l111+='/dm/front/jdJoinCardtf/shop/shopList',llI1I1={'open_id':'','mix_nick':ilil1I||'','user_id':ii1iiI},l1iIII=Iliii1(IlIlll[I1iIIi(0x1e0,'x0F&')],{});break;case IlIlll['JMPkK']:l1l111+=IlIlll[I1iIIi(0x18c,'BE49')],llI1I1={'open_id':'','mix_nick':ilil1I||'','user_id':ii1iiI},l1iIII=Iliii1(I1iIIi(0x1f1,'vIuW'),Object[I1iIIi(0x250,'ZF!O')]({'missionType':$[I1iIIi(0x23a,'jIng')]},$['goodsNumId']?{'goodsNumId':$[I1iIIi(0x204,'h]cL')]}:{}));break;default:console['log'](I1iIIi(0x172,'N(dT')+iiillI);return;}const lIli1I={};l1iIII&&Object['assign'](l1iIII,lIli1I);if(llI1I1){if('KVpkY'!==I1iIIi(0x22f,'5gnC')){Ii1iI1[I1iIIi(0x237,'By%J')](lilIli+'账号无效'),Iliili[I1iIIi(0x1b2,'jT&h')](IlIlll[I1iIIi(0x236,'FgFu')]),Iliill['needRemoveCookieIndex'][I1iIIi(0x144,'FgFu')](IIII11);return;}else Object[I1iIIi(0x142,'#8lh')](llI1I1,lIli1I);}const II1il={'url':l1l111,'method':IlIlil,'headers':{'Accept':I1iIIi(0x15d,'9b#L'),'Accept-Encoding':I1iIIi(0x1c9,'5gnC'),'Accept-Language':IlIlll[I1iIIi(0x1f3,'CM0f')],'Connection':I1iIIi(0x1d5,'nOw3'),'Content-Type':'application/x-www-form-urlencoded','Cookie':iI11I1,'User-Agent':iil1il,'X-Requested-With':I1iIIi(0x1de,'3zQf')},'params':llI1I1,'data':l1iIII,'timeout':0x7530};IlIlll[I1iIIi(0x15b,'Exu!')](IlIlil,IlIlll[I1iIIi(0x17e,'jIng')])&&(IlIlll[I1iIIi(0x210,'VuSc')]===I1iIIi(0x208,'BJ5E')?(delete II1il['data'],delete II1il['headers'][IlIlll[I1iIIi(0x1b5,'r2kd')]]):Iillii[I1iIIi(0x18d,'jPIq')]('❓'+IlI1iI+'\x20'+Iillil['stringify'](l1lIli)));illlI1['includes'](IlIlll[I1iIIi(0x246,'ELj)')])&&(Object['assign'](II1il[I1iIIi(0x202,'iyFG')],{'Origin':IlIlll[I1iIIi(0x1bb,'N(dT')],'Content-Type':I1iIIi(0x1ae,'r2kd')}),delete II1il[I1iIIi(0x180,'CM0f')][I1iIIi(0x232,'r2kd')]);const lllI11=0x1;let I1lIll=0x0,I1lIli=null;while(IlIlll[I1iIIi(0x21f,'4G0*')](I1lIll,lllI11)){IlIlll[I1iIIi(0x1af,'BJ5E')](I1lIll,0x0)&&(I1iIIi(0x248,'IU!B')===IlIlll[I1iIIi(0x242,'N(dT')]?await $['wait'](0x3e8):(iliIII=iIIl1i[I1iIIi(0x194,'h]cL')]((lI1ll1,iIiI1)=>!Iliil1['needRemoveCookieIndex'][I1iIIi(0x1a2,'*FJP')](iIiI1+0x1)),ill111['needRemoveCookieIndex']=[]));const lillII=await common['request'](II1il);if(!lillII[I1iIIi(0x207,'&9MI')]){if(IlIlll[I1iIIi(0x19e,'jT&h')]!==IlIlll[I1iIIi(0x15c,'iyFG')]){I1lIli='🚫\x20'+iiillI+'\x20请求失败\x20➜\x20'+lillII[I1iIIi(0x1fa,'IU!B')],I1lIll++;continue;}else i1ii=0x1;}if(!lillII[I1iIIi(0x261,'IU!B')]){if('IzKLC'==='IzKLC'){I1lIli=I1iIIi(0x1d7,'w&Gq')+iiillI+'\x20请求失败\x20➜\x20无响应数据',I1lIll++;continue;}else IiiIll[I1iIIi(0x25e,'N(dT')]=IIlii?.[I1iIIi(0x174,'#8lh')]?.['data'],IlI1il['log'](''+IilliI+(IlI1ii[I1iIIi(0x19d,'wDzU')]||lIIiii[I1iIIi(0x17a,'L5Um')]?.[I1iIIi(0x1a3,'lp9I')]||'')),iI1lli[I1iIIi(0x1ed,'VuSc')](''+(ll1iI['msg']||iI1lll['mission']?.['remark']||''));}await IlIlll['rnlEx'](liiIIi,iiillI,lillII['data']);break;}IlIlll[I1iIIi(0x272,'GJP0')](I1lIll,lllI11)&&console[I1iIIi(0x15e,'r2kd')](I1lIli);}function Iliii1(IlIliI,l1iII1){const I1iIIl=iIIiil,iiill1={'bTfrB':function(lIli1i,IIIII1){return lIli1i(IIIII1);},'LKhku':function(I1lIlI,ii1ill){return IlIlll['VhKHz'](I1lIlI,ii1ill);}};if(IlIlll['cqStZ']('fBRSo',IlIlll[I1iIIl(0x15f,'m^ME')])){const llI1II=iiill1[I1iIIl(0x23e,'klmo')](i1l1I,IiilIi);iiill1['LKhku'](llI1II,0x0)&&(iii1Ii[I1iIIl(0x143,'vIuW')]=llI1II);}else{const lIli1l=iIiIi({'actId':i11il1,...l1iII1,'method':IlIliI,'userId':ii1iiI,'buyerNick':IlIlll[I1iIIl(0x14e,'DqA@')](ilil1I,'')}),lillIi={'jsonRpc':IlIlll[I1iIIl(0x260,'P@36')],'params':{'commonParameter':{'m':I1iIIl(0x182,'vIuW'),'oba':lIli1l[I1iIIl(0x16e,'N(dT')],'timestamp':lIli1l[I1iIIl(0x217,'w&Gq')],'userId':ii1iiI},'admJson':{'actId':i11il1,...l1iII1,'method':IlIliI,'userId':ii1iiI,'buyerNick':ilil1I||''}}};return IlIliI['indexOf'](IlIlll[I1iIIl(0x162,'lf86')])>-0x1&&delete lillIi['params']['admJson'][I1iIIl(0x25f,'vIuW')],lillIi;}}function iIiIi(illIi1){const lI1IIl=iIIiil;if(IlIlll[lI1IIl(0x275,'jIng')]('VgJVe',IlIlll[lI1IIl(0x212,'CS%C')])){const ii1ili=lI1IIl(0x276,'By%J'),liil1i=IlIlll[lI1IIl(0x175,'DqA@')],lI1lil=new Date()[lI1IIl(0x21d,'By%J')](),i1l1iI=new RegExp('\x27','g'),liil1l=new RegExp('~','g'),lI1lii=IlIlll[lI1IIl(0x1d1,'GJP0')](encodeURIComponent,JSON['stringify'](illIi1))[lI1IIl(0x1ad,'jIng')](i1l1iI,IlIlll[lI1IIl(0x14c,'ZF!O')])[lI1IIl(0x1d4,'*FJP')](liil1l,lI1IIl(0x16c,'w&Gq')),Iiili1=IlIlll['ousfv'](IlIlll[lI1IIl(0x25d,'Exu!')](IlIlll['ousfv'](IlIlll['ousfv'](IlIlll[lI1IIl(0x247,'By%J')]('f',liil1i)+'D',lI1lii),'c'),lI1lil),ii1ili),Iil1l1=CryptoJS[lI1IIl(0x1fd,'N(dT')](Iiili1[lI1IIl(0x1ff,'m^ME')]())['toString']();return{'sign':Iil1l1,'timeStamp':lI1lil};}else lIIii1[lI1IIl(0x1d8,'*FJP')](lI1IIl(0x269,'vIuW')+ll1i1+'\x20请求响应\x20'+(IIli1i[lI1IIl(0x18f,'g7GP')]||I1iIi1));}}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
