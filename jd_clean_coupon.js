/*
删除优惠券
环境变量：JD_COUPON_PIN_FILTER_GOODS // 需删除优惠券的账号（填入pin，多个用@分割）
          JD_COUPON_DELETE // 需删除优惠券的关键字（填入关键字，多个用英文逗号，@，换行分割）(默认删除：限购@部分商品)
          JD_COUPON_EXCLUDE // 需保留的优惠券关键字（填入关键字，多个用英文逗号，@，换行分割）(默认保留：东东@农场@无门槛)

cron:1 1 1 1 *

*/

const $ = new Env('删除优惠券')
var iｉl='jsjiami.com.v7';const i11il1=iii1II;(function(lllill,ill11l,I1lIiI,lllili,IliiiI,Ill11,liiIII){return lllill=lllill>>0x6,Ill11='hs',liiIII='hs',function(li1i11,iI11I1,il1i1l,IlIlll,IIIl1I){const ilil1I=iii1II;IlIlll='tfi',Ill11=IlIlll+Ill11,IIIl1I='up',liiIII+=IIIl1I,Ill11=il1i1l(Ill11),liiIII=il1i1l(liiIII),il1i1l=0x0;const iil1ii=li1i11();while(!![]&&--lllili+iI11I1){try{IlIlll=parseInt(ilil1I(0x1e6,'aKps'))/0x1+-parseInt(ilil1I(0x211,'#yS8'))/0x2+-parseInt(ilil1I(0x1a9,'SO&F'))/0x3*(parseInt(ilil1I(0x1e5,'zuPu'))/0x4)+parseInt(ilil1I(0x14f,'ThHF'))/0x5+parseInt(ilil1I(0x1df,'OJ!i'))/0x6*(-parseInt(ilil1I(0x222,'OJ!i'))/0x7)+parseInt(ilil1I(0x207,'*lOR'))/0x8+parseInt(ilil1I(0x174,'8)1!'))/0x9;}catch(IlIlli){IlIlll=il1i1l;}finally{IIIl1I=iil1ii[Ill11]();if(lllill<=lllili)il1i1l?IliiiI?IlIlll=IIIl1I:IliiiI=IIIl1I:il1i1l=IIIl1I;else{if(il1i1l==IliiiI['replace'](/[JgLlwSFBufMrHVTqpb=]/g,'')){if(IlIlll===iI11I1){iil1ii['un'+Ill11](IIIl1I);break;}iil1ii[liiIII](IIIl1I);}}}}}(I1lIiI,ill11l,function(il1i1i,lil111,i11ilI,ii1ii1,llllI,lllil1,iil1il){return lil111='\x73\x70\x6c\x69\x74',il1i1i=arguments[0x0],il1i1i=il1i1i[lil111](''),i11ilI=`\x72\x65\x76\x65\x72\x73\x65`,il1i1i=il1i1i[i11ilI]('\x76'),ii1ii1=`\x6a\x6f\x69\x6e`,(0x1743ec,il1i1i[ii1ii1](''));});}(0x3300,0x8fab7,Iii11l,0xce),Iii11l)&&(iｉl=`\x4a6`);const jdCookie=require(i11il1(0x1fa,'ThHF')),notify=require(i11il1(0x220,'*lOR')),common=require(i11il1(0x17c,'0utD')),{H5st}=require('./utils/Rebels_H'),excludeKeywords=(process[i11il1(0x1f5,'LZwb')]['JD_COUPON_EXCLUDE']||'东东@农场@无门槛')[i11il1(0x22a,'&7u@')](/[,@\n]+/g)[i11il1(0x1c4,'rMzl')](l1llII=>l1llII['trim']())['filter'](Boolean),requiredKeywords=(process[i11il1(0x201,'Vu(b')][i11il1(0x20f,'HSvD')]||'限购@部分商品')['split'](/[,@\n]+/g)[i11il1(0x24d,'#yS8')](IilIll=>IilIll[i11il1(0x19c,'2p03')]())[i11il1(0x192,'lMB7')](Boolean),pinFilterGoods=(process[i11il1(0x201,'Vu(b')]['JD_COUPON_PIN_FILTER_GOODS']||'')['split']('@'),isNotify=![];let cookie='';function Iii11l(){const liiIIi=(function(){return[...[iｉl,'FBjFMswjqugipbqaVJmLbil.ucrofHmT.lFvfuS7==','WR9BWPFcKCkl','ymoHra','y3BcU8opWQa','WO7dLur5mG','kmoSWRBdMG','mSkMhrmdAc0','W584W53dS3e','5PEN5y6X55s35lY45OgB5yQ25OUa5P6y6i6t5yYJ5yMu5lYt5OcO5yUR5yIG6kc/','W6/dOYNdHSki','W7WynmkXoeldUH3cMhFcRq','W6ZcSGNdHdm','W6JcPKb4hGZdRa','WRTLW7mRW5jbW6/dRW','yCopW6XFW6tdSCoTfKhcQG','W5RcOmkJW6nx','eCkimmkiW6/dRCkTpq','WPv5mSo6ea','omkGfa','5yUB6zUV5lMT6l+c5l2B5OkW5yU35OM85yQHEEkCKW','oCkQaaeoyZe','W6C0WRZcTYC9W5JcOMv+BG','WOzAeCoInq','WQv4W7m3W5i','WRlcShRdKSo8kXtcRW','W7RdLahdRSk7gNa','WRnufSoSbGu','FmkZW7BcSYG','wmkFWQ0+wLOU','BLtcH8oPWR8','uYnW','5Rkt5Ow15lIf6Ak777+n5Rkv5lUm6k+N5yM56lY46kge77+m5RoN5lI16k+85yQd6lYz6kg844od','fCkEqN9Fxa','WOJcVCoBgCoaW4X9y1vm','WR0EW5RcICklWRa','AZf4','W6tcRvm','W63cGeJcSSkA','WPePyCkzW6y','WOVcSX7cMGK','eCkel8koW7tdVCkajGBcJJ9xWOZdT1pdQHVcV8klW6HtsW','sCkgW4xcOZnZCSovomk+c8oyWObPDslcJgBcMXlcSezvBSoUumo6uKzljSkYm8oBgCoVW6NcTNzevq4kuSorW7tcR8o5ymkGWRfGWOvSst7cUSo2rSogjLNcRXbNW49kW5NcSCkVxmoNWRVcOs17W65rWPlcObdcKevYhSo9zmk2W6OjW4ujWOBdHYjHWR3cPmoMWPGOWO9LW6JdS0rsWQGTWOtdKSkNrwryeCocW4lcMhBcLSoqymo+WPFcQLWDdvHloa','eSkIEe5+','hcVdNatcNCktWONcTa','5zk95OkB5lQh77+f6k6V5OUZ5yIC5zYEW5SGW4RKUANLMyxML43NQl/MGjRLPP7KVlRMGkpLIjFJGQ4','D2VcLG','ySoDWRfz','W7RcTNVcT8kcW6C','W4pcI1SEW48labm','cbBdP8kHWRi','nmkjW60nWRBdUmkbrJxdSqNcMa','n8kGbGiaAJ0+','F8k9z8k2W601WOOAvmkvy8oKv3C','WOS+W4VcOSk1','cs4iWRah','W4pcVLyeCrpcQan2ne8','rSkvWR4','5yUD6zIz5ywl6zEd5A+hWOVdVwy','W7VcTgBcTmkG','BNFcLmofWOHZAW','5yUs6zIC5l+P5OkP5yQE5QYR5PAN6l2Y5AAK77+t5AwQ5l+B55Qd5QYy5PAw6kY15yAc5OIg6kkf6iwp5P2oDG','WOJdJx4','ca/dRCkHWRjhna','sCokhISFaCo4WR08ea','W4FcRv7cRSkhW6ugdJi6rvuDW6SgWOdcICoYW4BdLGZdGCoMW7KtBCkLWOtdLSoGeCo7W4uMDCowfGWEb0/cMLbAvZdcMZhdKu9aC8oPcuLorSofWQRdL8klAd/cMSoNtwKje3RcHfLaW6pdGM4PW7VcRwFcM8oyAYJcS1qBW4VdMMfgW5Hcu8k/WRJcUCkBh8kmzCk2WOqRC18dW7eVW6qBW6hdVCkQuI00paiuWPxdJxn1ub/cK3RcSwpcTaS','W5irW53dGf3dKv7dO8o5wSkJ','WOhdPMGfWOu','ob7dHSo7W6NcMW','W5nglW','imoqW7n3hXrH5B6s5AAN44gc5lQC5lQT6lA05y+B','WQq7W6/cU2C','WQnSWOq','WOLbW67cHmkYyCk9ieZdRW','WOJdOwLjaa','DYTSsa','gSkuwwHewSkAW6nWrqu','W5zhDSkUimkOd8oIW5/cSa','WP9rW7xcVCk2','WOraWRFcQSkNESkQjf3dR8kRk2/dTsPJWPy','aSospmoQWR0','W7tdLaK','CazyzmoT','WRqdW48','WOBdPM9YhZG','4P+SW6FMN6ZNNA7OR5RMSjxcRG','W7VcNu0FW6anca','WO4nvmkeW6q','W58DWQRdUCoJiCo4DxNdO8kamhhdMW','eW4fWQOI','WQJcVMpdLG','vcP6W7f2','W5j8CSkGp8ow','rmogesuwcCoZWRC5fa','k8o8pSoY','WOZdLwldKJOUW4aM','WP9rW53dHfVdK3NcPCoFu8kKW7GSz3lcHmoJWRmRkSkTW4SU','DwRdU0ZcS8kNW7e','emkvx31zqa','W6JdRdFdL8kA','AmkaW5lcOYTmz8ki','fSkonSkBW6/dTSkqpqRcKJu','4P63WQVMNOlOR5dKVzVMGRdLI7FLIBVOOzBLPAJOTlpdNYvlWQG','W5ZcJcRdUa59','kSo2WR7dJwldICkPe8k9WRZcUhSyF8oReCo+v8kal2XlgSk0oCklWQCP','gI3dMam','mmkQhWaAAG','WR47W6S'],...(function(){return[...['W5f2sSkQEW','W4ZcQmkH','WOldI3vPabm','WQmqW7JcGwa','e3FdPaRdLHa','ltVdN2HI','vIj0W4DwobtdVa','WOTiW5maW5m','sxxcOmorWPK','CwVcMmok','WQBdVLu9WO7cQq','WQ5UW4/cICkg','hCkAwhK','WRPWWOBcUSkBqxO','WRHSW70','WPFdPaa','W45hz8kDySkMcmoIW4W','WPmCvCki','W4WXBtWC','WQpdUeS6','WPddKhbW','WPpdG3bP','lvtdOIJdTq','yZTZuSooW6a','WQXSWPBcQ8kwq3yCWQuXmWOVW6W','5PAb5y+T55AI5l2x5Ogy5yMm5OQX5P+d6i6q5y6S5yIt5l685Oge5yQ95yIk6kkX','W5XgpCo6mCkp','W7xdNH3dSCk/hhS','5lUY5l205Ogi5yU8','W5lcII3dLWvYWRq','WPldT8oYWRKuzmk6W7DzW5aDDKK','WRbmW5NcQSkU','WRu5W6dcGxq','jdBdHh7dQSkNW5j6','fCkusW','WPeyvSkkW6tdMq','W4CWW47dPgO','mr/dJmo0W63cVCk8j8k8','5PA45y6v55wH5l+C5OkM5yIX5OUW5P6V6i+l5y++5yMm5lYY5Ooi5yUE5yM56kkr','5yI76zMG5l+P5Oge5yUs5AsU6lsR','W5FcTmkLW7Ty','fXpdO8kRWQnNm2i','WQRcSgK','W6NcRvhcT8keW6CtwhDX','WO1lW6/cUCk4FmkAkf/dPSkI','W7VcI1K','WQLofmo0bHjTrG','W44ZeW','oSoReCoVWQfJW5G','cG/dQ8kWWQ5+i1pdQCkDEmkVkmoYyG/cVxhcSCoCW6RdU2/dJComW5GIWRi','WQ15o8ovoa','W4hcTCkJW6O','4P6utoADJEISPUs/OoAaT+wjNowkREIJUUwKGEI0S33dGSkrjq','uIpcHLjjDCoVWRu','WOZcJ1VdQCo/','WRm1W7ZcKSkT','F2hcNCobWP56tCkzW4bBWPVdICkZva7dM8k+W5RdVmkcCMi','WRvteSo5erPT','osRdKvbx','W5fnDa','AJ9V','WRKjW6hcKLe','W4/cN0ZdItqXW7i','W7NcSKJcRSkF','zSoyW7fFW7xcOmk8qGBdUXtcJSonW5vOxZ8','W7PvySkBsq','5P+I6k6Y5yUt5ywr5PYo','W4icc8k6ka','W60zkCkX','WR/dSgrNjtfooq','W7FcRWX/W5VdQSo7W67cHSk6keyd','W5vMBCk9pCok','gmk4d8kMW4S','WQRORlxMSABLP7BOT47cQEkFUWhML6FLK5NLU6hMLixMJzS','uUI1NowoVSkF','sSo1W40uDW','kHNdJmoUW7W','kdZdHmkwWOGUpmkqWO1iW4ddG8ohc0tdJCoiW4/dQmoDCItdL0qKW4DWpILZySo+','pCoWjCoVWRDHW5viFW','W5xcTmkJW6Ppo8oR','WQq6WOqTW4e','draiWOGw','FxRdU0ldQSk1W6i','WONdRhrLbd53nCkpW7lcRG','amk8paCS','vEISLUAWGEwqPUw4Lmk4','5lY255Al5yED6zwh5A+4WPGPqq','WOZdIMdcQvSIW6FcRSo7W6ldLCorFW','5y+U5Bot5yIf6zM9772M','WO8ivSkOW77dLq','WPvVWPpcISkb','r8kFWQOUvfKU','W58jqrK3W7ddOmoCWRahWQK','nCoFWOZdVMKNwSkrqCoGuCk7','WOldMrJcNMqEW7afW4bUFW','W4S1W7XbWO3dL8o0Cq','W55QCSk6oCoFW5e','WQ3dSKO6WORcVmkO','p8oMWRFdJw7dRq','W6pcReFcQ8kEW60cuG','WRrpa8o5hZH9wa','eMpdPYRcLrVdLCkaqbnn','tCkqW4RcRWy','WOBdRgy','W5KFk8k1aG','6lAB5y+v5PEZ5PAw','W5y0W5LeWOddLSo1','WRxcTehdSmov'],...(function(){return['W6CFjmk/aMddUbC','prq/','W5/cNLVdHYq','WODnW5CcW4y','WODkW77cRmkV','ESoEW7aKuCoz','iSktWRzyW4BcP8k3tbNdUW','W7hcUKi','4PYZt+AEVEIdG+ATHEEIMowLTEEqL8kH','BeNcRH8oW6/dGa','WRW9W7JcJx4GWO0','W5aLrd09','lbupWQ0+Bmkc','W5zHDW','EmotWPPvW73cRCk8','W5DtlSo/eq','WOyxWRCGW55VWRm','WRSHW4/cL8kC','5P++6k+M5yUb5yEv5P+J','W5ZdQSkBx8kFWPm/E2XUEaVcLa','W5RcR8oRW4HJE8o0W5GlW61zeGLNW53cV8kewtbskCkoW5VdHd3dLKNcTqf+grCMWOXqW6maWPaRxtebW5uHWQpdMmo3','WOlcVmoDdmoDW5y','5yE45yMw6zIJ','W5hcNfiaW68','EmokW7aCqG','W7BcRNhdKcu','WRVdTX3dV8ozWRHtyMfwfYfb','p8kLhmkOW4/dJCktbJ3cOrr8WOZdM3tdMW','W5HwrCkMvq','W6f4WRJdUsTYW57cMt9ojLyp','WRddG11Saq','pHRdHSoOW6q','zdfQumouW6dcOSolvmkq','W6X7k8oSeW','y2RcSGyB','qSk9W4JcPtG','W6lcTLdcT8kyWRnidMzKhfTyWQW8WOxdG8kQWONdUhpdTCk2W58','WPJcUCohgCo9W5DN','tSk5WRW0uq','W6NcRvhcT8keW6C0vx54ea','W5S6xSkGnSomW5feW4uDW6mjW7/cPmkff8oMuSkSqCoaueew','kmktw3T6','W5jioa','WOddI2P+cHrkeW','W4xdVCoBhCogW456nxDmqWJcTtq2WRyFdNhcU3/dQZuRW5ZdIIO','c23dOYe','WO/dJJJdPsH1WOlcMG','4P2sWPVOHOBMNBROV7tOO7VPGB7LI77KUzZPLyFORBBdUG','CwddQ2e','W59GzG','WR52WOBcQCkaz3SXWQWRlWWYW5rHrhBdTCk4WRFdMCodWP1AW4fmb8of','BgxcMmoq','CmomW4KBtW','WPldSMTPfa','eNldPIBdJa','W4lcLLiIW4a','WP7dReD8eZvh','CLFcN8oIWOG','W6XTlmoOba','WO/dTwrNeG','zIpcKeLGEG','Dd/cJKu','WQRdOriHgG','AelcVGaAW6ZdGmo1','WP4xWPy','WO7cU8oEa8om','B03cSaK','WQVcUN3dGmoXaGq','WPesxW','omoSWQ7dJ3tdRCkKpSk0WQBcPh0frW','5yUV6zMN5l+75Oc75yUb5OI95yQa','5lUa5l6B5OoH5yIT','WQfGW7K3W7vqW6q','W6FcGSks','WRX3WOlcR8kmxG','5y+g6yw054IQ5Ogx57U35P+ObmoZW6DJWQtdJCkkW7CCW5G','WQzKW6qMW4TRW7/dSq','WPP0W6ZcVmkJ','WQ3cRGGTW5NdRmkPW63cQCoisbKQW4ddR8kjWO0','W5JcSMbHkJzYkW','kCoGoCovWQe','WQxcSgddLCo5aG','wMJcM0FdG8oQW7C','WO9uW6RcPCk+CCkVnuldPCkPA2FcVs85WOZcVmoZWRXuFmoUE8kNqvVcHCkbW41OzmoK','ygRdV2JdP8k3W6a','WQvwWQ7cGCky','5y2T5Bk95yQ86zIY77Y+','W5Phz8kDySkMcmoIW4ZcGZ3dOmkaAa','W7z3w8kMFG','WR4PW7W','jthdLb/cP8kHWPdcOW','WP3dOMHH','sc1+W58','WRxcQ3ZdMSo+aGJcPmon','W7FcIe4aW6GjdaldT8ooWOzbdSoqWOxdPa','t8otWRjiW6dcPSkScItdPWJcHa','W57cKcZdOqz9WOFcHmoPW4ZdKG','W7/cSuhcPSkjW6uc','W6BcRum','W5apwqaSW43dH8oA','CMRcLCobWPi','W5nmjSoTkSkj','W486W68','ovRdNG3dJa','WOjlW70','44gl5O2t56EH44kU6k+S5yEl6i265y6gWPhcPSkNFX9w'];}())];}())];}());Iii11l=function(){return liiIIi;};return Iii11l();};const cookiesArr=Object['keys'](jdCookie)[i11il1(0x25a,'!IrP')](lI11Ii=>jdCookie[lI11Ii])[i11il1(0x18a,'2p03')](Iiill=>Iiill);function iii1II(_0x182a85,_0x2b758d){const _0x22085a=Iii11l();return iii1II=function(_0x3a08cd,_0xa6bce6){_0x3a08cd=_0x3a08cd-0x11f;let _0x36f558=_0x22085a[_0x3a08cd];if(iii1II['DurxyG']===undefined){var _0x2cffaf=function(_0x23fd0f){const _0x4e6597='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5c5980='',_0xb8a9a9='';for(let _0x1a8028=0x0,_0x4afd07,_0x575fe5,_0x2c406f=0x0;_0x575fe5=_0x23fd0f['charAt'](_0x2c406f++);~_0x575fe5&&(_0x4afd07=_0x1a8028%0x4?_0x4afd07*0x40+_0x575fe5:_0x575fe5,_0x1a8028++%0x4)?_0x5c5980+=String['fromCharCode'](0xff&_0x4afd07>>(-0x2*_0x1a8028&0x6)):0x0){_0x575fe5=_0x4e6597['indexOf'](_0x575fe5);}for(let _0x415b36=0x0,_0x252c41=_0x5c5980['length'];_0x415b36<_0x252c41;_0x415b36++){_0xb8a9a9+='%'+('00'+_0x5c5980['charCodeAt'](_0x415b36)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xb8a9a9);};const _0x7fa835=function(_0x3e9057,_0x561887){let _0x52c839=[],_0x3e31c0=0x0,_0x5a48ab,_0x3db2bc='';_0x3e9057=_0x2cffaf(_0x3e9057);let _0x5b460e;for(_0x5b460e=0x0;_0x5b460e<0x100;_0x5b460e++){_0x52c839[_0x5b460e]=_0x5b460e;}for(_0x5b460e=0x0;_0x5b460e<0x100;_0x5b460e++){_0x3e31c0=(_0x3e31c0+_0x52c839[_0x5b460e]+_0x561887['charCodeAt'](_0x5b460e%_0x561887['length']))%0x100,_0x5a48ab=_0x52c839[_0x5b460e],_0x52c839[_0x5b460e]=_0x52c839[_0x3e31c0],_0x52c839[_0x3e31c0]=_0x5a48ab;}_0x5b460e=0x0,_0x3e31c0=0x0;for(let _0x31a748=0x0;_0x31a748<_0x3e9057['length'];_0x31a748++){_0x5b460e=(_0x5b460e+0x1)%0x100,_0x3e31c0=(_0x3e31c0+_0x52c839[_0x5b460e])%0x100,_0x5a48ab=_0x52c839[_0x5b460e],_0x52c839[_0x5b460e]=_0x52c839[_0x3e31c0],_0x52c839[_0x3e31c0]=_0x5a48ab,_0x3db2bc+=String['fromCharCode'](_0x3e9057['charCodeAt'](_0x31a748)^_0x52c839[(_0x52c839[_0x5b460e]+_0x52c839[_0x3e31c0])%0x100]);}return _0x3db2bc;};iii1II['fYdhsv']=_0x7fa835,_0x182a85=arguments,iii1II['DurxyG']=!![];}const _0x3ca58e=_0x22085a[0x0],_0x2a1669=_0x3a08cd+_0x3ca58e,_0x2242cc=_0x182a85[_0x2a1669];return!_0x2242cc?(iii1II['Yuojdh']===undefined&&(iii1II['Yuojdh']=!![]),_0x36f558=iii1II['fYdhsv'](_0x36f558,_0xa6bce6),_0x182a85[_0x2a1669]=_0x36f558):_0x36f558=_0x2242cc,_0x36f558;},iii1II(_0x182a85,_0x2b758d);}!cookiesArr[0x0]&&($[i11il1(0x187,'#yS8')]($[i11il1(0x176,'21IT')],'【提示】请先获取Cookie'),process[i11il1(0x17a,'cY%h')](0x1));!(async()=>{const ii1iiI=i11il1,l11i1i={'lCpTe':function(l1il11,IiI1){return l1il11(IiI1);},'gBluq':function(liI,illIli){return liI*illIli;},'uPvMU':function(l11i1l,lIII11){return l11i1l==lIII11;},'QMPUZ':function(IiilI,ii1I11){return IiilI===ii1I11;},'GwqED':'\x0a未设置环境变量JD_COUPON_PIN_FILTER_GOODS，退出执行~','skOCE':function(liIi1,lI11II){return liIi1<lI11II;},'OHNmw':function(l1llI1,llIIll){return l1llI1!==llIIll;},'zgehz':ii1iiI(0x1dc,'3wtw'),'vNfTX':ii1iiI(0x1f0,'*]je'),'Gdlln':function(IillIi,lii){return IillIi(lii);},'SjMSj':ii1iiI(0x14c,'xd[k'),'YCCGt':ii1iiI(0x15c,'(6Fb'),'jAmYC':'knKPu','iSnFb':ii1iiI(0x120,'cBc3'),'SDdbZ':function(IllI1i){return IllI1i();},'UjALP':ii1iiI(0x126,'^x)P'),'RTHVD':ii1iiI(0x25e,'RtuP'),'yCFyx':'FEFnq'};console[ii1iiI(0x13b,'#j5@')]('=========='+$[ii1iiI(0x199,'ayO9')]+'变量开启状态=========='),console[ii1iiI(0x161,'5Eae')](ii1iiI(0x13c,'^HHJ')),console['log'](ii1iiI(0x149,'Vu(b')),console[ii1iiI(0x14a,'cBc3')](ii1iiI(0x1de,'*lOR')+excludeKeywords[ii1iiI(0x221,'&7u@')](',\x20')+']'),console[ii1iiI(0x16d,'^x)P')](ii1iiI(0x156,'ayO9')+requiredKeywords[ii1iiI(0x185,'Tfs5')](',\x20')+']'),console['log']('执行账号:\x20['+pinFilterGoods[ii1iiI(0x191,'cBc3')](',\x20')+']'),console[ii1iiI(0x234,'!#cz')](ii1iiI(0x179,'(6Fb')+$[ii1iiI(0x176,'21IT')]+ii1iiI(0x23f,'IXG#'));if(l11i1i[ii1iiI(0x13a,'cBc3')](pinFilterGoods,'')){if(l11i1i[ii1iiI(0x128,'OJ!i')](ii1iiI(0x216,'5V#V'),ii1iiI(0x205,'k0mX')))I1i11l[ii1iiI(0x23c,'Ashl')]=!![];else{console[ii1iiI(0x238,'ayO9')](l11i1i[ii1iiI(0x1c9,'&yEM')]);return;}}notify[ii1iiI(0x245,'21IT')]({'title':$[ii1iiI(0x14b,'ThHF')]});for(let lil=0x0;l11i1i[ii1iiI(0x1f3,'21IT')](lil,cookiesArr[ii1iiI(0x1ab,'ayO9')]);lil++){if(l11i1i['OHNmw'](l11i1i[ii1iiI(0x12c,'iH&u')],l11i1i[ii1iiI(0x1ac,'0utD')])){$[ii1iiI(0x258,'cBc3')]=lil+0x1,cookie=cookiesArr[lil],common[ii1iiI(0x198,'&yEM')](cookie),$[ii1iiI(0x1bd,'j4AO')]=l11i1i[ii1iiI(0x20b,'x!eR')](decodeURIComponent,common[ii1iiI(0x24b,'&yEM')](cookie,l11i1i['SjMSj'])),$[ii1iiI(0x1e3,'ioup')]=notify[ii1iiI(0x160,'8Q1)')]($[ii1iiI(0x1f8,'8)1!')],$[ii1iiI(0x24e,'Tfs5')]),$[ii1iiI(0x1bb,'iH&u')]=ii1iiI(0x144,'aKps')+common['genRandomString'](0x4,l11i1i[ii1iiI(0x18f,'Ashl')])+'_0',$['nickName']='';if(pinFilterGoods[ii1iiI(0x1eb,'xd[k')](l11i1i[ii1iiI(0x166,'2p03')](encodeURIComponent,$[ii1iiI(0x1cd,'%f2E')]))){if(l11i1i[ii1iiI(0x1c5,'#yS8')]===l11i1i[ii1iiI(0x22d,'cBc3')]){i1ili1[ii1iiI(0x140,'rMzl')]('账号无效');return;}else console[ii1iiI(0x1ef,'%f2E')](ii1iiI(0x162,'ioup')+$['index']+'】'+($[ii1iiI(0x1f4,'*]je')]||$[ii1iiI(0x14d,'x!eR')])+ii1iiI(0x246,'Tfs5')),await l11i1i[ii1iiI(0x22e,'5Eae')](Main);}else{if(l11i1i[ii1iiI(0x1d9,'LZwb')]===ii1iiI(0x16e,'rMzl')){pinMsg=ii1iiI(0x1d2,'LZwb')+pinFilterGoods+']\x20不在账号列表中，请检查环境变量是否配置正确\x0a';continue;}else lilIl1[ii1iiI(0x1b5,'x!eR')](i1l1ii[ii1iiI(0x236,'5V#V')],ii1iiI(0x25d,'Rrv*')),i1l1['exit'](0x1);}common[ii1iiI(0x127,'*]je')]();if($[ii1iiI(0x1e1,'ayO9')])break;await $[ii1iiI(0x19d,'2p03')](0x7d0);}else{let llliil='';const liIl1=IiilIl(iii1Ii[ii1iiI(0x16a,'8)1!')]),II1lll=l11i1i[ii1iiI(0x1ff,'Cl[[')](iii1Il,lI1IiI[ii1iiI(0x12d,'HSvD')]);if(i1lI[ii1iiI(0x1e4,'Cl[[')]===0x0)llliil='满'+liIl1[ii1iiI(0x202,'ThHF')](0x2)+'元减'+II1lll[ii1iiI(0x22c,'%f2E')](0x2)+'元';else{if(IlI1l[ii1iiI(0x21b,'xd[k')]===0x3){const II1lli=l11i1i[ii1iiI(0x142,'xd[k')](0x1-II1lll,0x64);llliil='满'+liIl1['toFixed'](0x2)+'元打'+II1lli[ii1iiI(0x204,'!#cz')](0x0)+'折';}}return lilIil[ii1iiI(0x25c,'8)1!')](ii1iiI(0x24a,'IXG#')+i1l11['limitStr']+'('+llliil+')('+i1l1li[ii1iiI(0x15e,'0utD')]+')'),i1ilii['couponid']+','+iIIII1[ii1iiI(0x1b3,'xd[k')]+','+i1l1ll['couponStyle'];}}if(pinMsg)console['log'](pinMsg);const lI11I1=notify[ii1iiI(0x165,'8)1!')]();lI11I1&&(l11i1i[ii1iiI(0x18d,'FB]z')]===ii1iiI(0x18b,'#yS8')?(console['log']('\x0a📣\x20运行结果\x0a'+lI11I1[ii1iiI(0x248,'SO&F')](/：/g,'\x20➜\x20')),isNotify&&(l11i1i['yCFyx']===ii1iiI(0x1c2,'FB]z')?(notify['appendContent']('\x0a'),await notify[ii1iiI(0x167,'rMzl')]()):Iliiil[ii1iiI(0x140,'rMzl')](ii1iiI(0x1a1,'&7u@')))):li1Ii[ii1iiI(0x1fb,'&oGq')]('无可用优惠券或未获取到优惠券列表'));})()['catch'](IiIi=>$['logErr'](IiIi))[i11il1(0x123,'3wtw')](()=>$[i11il1(0x1cc,'*]je')]());async function Main(){const lllilI=i11il1,iI1ll1={'mYLMK':function(l1il1l,liIil){return l1il1l!==liIil;},'gdnSx':lllilI(0x20d,'aKps'),'wscpu':function(IllI1I,liIii){return IllI1I===liIii;},'CeqPN':function(II1ll1,IlI1Ii){return II1ll1(IlI1Ii);},'dVElY':function(i11I1I,l1il1i){return i11I1I(l1il1i);},'tPvut':lllilI(0x124,'0utD'),'etVxX':function(ll1,iI1llI){return ll1-iI1llI;},'EYRXN':function(llliii,IllI11){return llliii===IllI11;},'QhwcQ':function(l1llIi,II1llI){return l1llIi===II1llI;},'OCfeg':lllilI(0x136,'^x)P'),'NIWQw':function(i11I11,l1llIl){return i11I11(l1llIl);},'KiXQQ':'queryJdCouponListAppletForJd','qvBsK':'WYfjq','fqlJf':function(ii1I1l,ii1I1i){return ii1I1l>ii1I1i;},'vPrtq':function(llI,llliI){return llI!==llliI;},'QTAtA':function(iI1li1,lllii1){return iI1li1>=lllii1;},'eipjc':lllilI(0x1ae,'LZwb'),'UYEbc':lllilI(0x16c,'cY%h')},IlI1Il=await common['getLoginStatus'](cookie);if(!IlI1Il&&iI1ll1[lllilI(0x21d,'(6Fb')](typeof IlI1Il,iI1ll1['OCfeg'])){console[lllilI(0x12f,'3wtw')](lllilI(0x1f1,'&yEM'));return;}try{$[lllilI(0x219,'*lOR')]=![],$['totalNum']=0x0,$[lllilI(0x158,'cBc3')]=[],await iI1ll1['NIWQw'](sendRequest,iI1ll1['KiXQQ']),await $['wait'](0x7d0);if($[lllilI(0x135,'21IT')]>0x0){if(iI1ll1['EYRXN'](iI1ll1[lllilI(0x157,'xd[k')],lllilI(0x190,'cBc3')))lIIiil['assign'](l1lIii,I11iI1);else{console[lllilI(0x1aa,'(6Fb')](lllilI(0x1ca,'j4AO')+$['totalNum']+'个优惠券'),$['message'][lllilI(0x17e,'(6Fb')](lllilI(0x206,'cBc3')+$[lllilI(0x240,'Ashl')]+'个优惠券');if(iI1ll1[lllilI(0x1a8,'#yS8')]($[lllilI(0x1c6,'aKps')][lllilI(0x13d,'(6Fb')],0x0)){let liIll=[...$[lllilI(0x129,'&oGq')]],IilIi1=0x0,iI1liI=0x0;while(liIll[lllilI(0x259,'5Eae')]>0x0&&!$['skipRun']){if(iI1ll1[lllilI(0x1d0,'HSvD')](lllilI(0x1be,'21IT'),'aKBzZ')){const l1lIiI=liIll['slice'](0x0,0x14);$[lllilI(0x239,'Rrv*')]=l1lIiI['filter'](llliiI=>{const ilil11=lllilI;if(iI1ll1[ilil11(0x1ba,'&z*W')](iI1ll1[ilil11(0x244,'cY%h')],ilil11(0x138,'zuPu'))){const IilIiI=excludeKeywords[ilil11(0x231,'j4AO')](IlII1=>llliiI['couponTitle'][ilil11(0x1b6,'&z*W')](IlII1)),i1i1I1=requiredKeywords[ilil11(0x213,'8Q1)')](IiI11=>llliiI['limitStr'][ilil11(0x18e,'#j5@')](IiI11));return llliiI[ilil11(0x254,'OJ!i')]&&!IilIiI&&iI1ll1[ilil11(0x163,'#yS8')](llliiI['coupontype'],0x1)&&llliiI[ilil11(0x180,'zuPu')]&&i1i1I1;}else ll1i1[ilil11(0x1e8,'Vu(b')]['fix'](IIli1i);})[lllilI(0x21e,'5Eae')](liIlI=>{const illlI1=lllilI;let lll='';const llli1=iI1ll1['CeqPN'](parseFloat,liIlI[illlI1(0x1d4,'8Q1)')]),iIli1i=iI1ll1[illlI1(0x121,'%f2E')](parseFloat,liIlI[illlI1(0x21f,'2p03')]);if(iI1ll1[illlI1(0x1b0,'iH&u')](liIlI['couponStyle'],0x0))lll='满'+llli1[illlI1(0x1f2,'!IrP')](0x2)+'元减'+iIli1i[illlI1(0x200,'LZwb')](0x2)+'元';else{if(iI1ll1['wscpu'](liIlI[illlI1(0x181,'HSvD')],0x3)){if(iI1ll1[illlI1(0x134,'Ashl')]('nFuCC',iI1ll1[illlI1(0x241,'8)1!')])){const iI1lii=iI1ll1[illlI1(0x210,'&yEM')](0x1,iIli1i)*0x64;lll='满'+llli1[illlI1(0x1b8,'cY%h')](0x2)+'元打'+iI1lii['toFixed'](0x0)+'折';}else IilliI[illlI1(0x15a,'2p03')](IlI1ii),lIIiii&&(I1l1II[illlI1(0x1da,'SO&F')]=!![],IIli1I['message']&&I1l1I1[illlI1(0x1fd,'5V#V')]['fix'](I1i111));}}return console[illlI1(0x155,'ioup')](illlI1(0x1e0,'&oGq')+liIlI[illlI1(0x257,'Cl[[')]+'('+lll+')('+liIlI[illlI1(0x168,'(6Fb')]+')'),liIlI[illlI1(0x150,'3wtw')]+','+liIlI[illlI1(0x214,'rMzl')]+','+liIlI[illlI1(0x1e4,'Cl[[')];})['join']('|');if($[lllilI(0x1a0,'RtuP')]){const iI1lil=$['couponinfolist'][lllilI(0x1c7,'xd[k')]('|')[lllilI(0x170,'%f2E')];if(iI1ll1[lllilI(0x20c,'IXG#')](iI1lil,0x0)){if(iI1ll1[lllilI(0x229,'2p03')](lllilI(0x175,'LZwb'),lllilI(0x1cb,'*]je'))){const iIli1l=lilIlI[lllilI(0x122,'Rrv*')](liiIIl=>lI1Il1[lllilI(0x1db,'%f2E')][lllilI(0x1e7,'!IrP')](liiIIl)),i1i1II=iii1I1[lllilI(0x22f,'%f2E')](iil1iI=>lilIi1[lllilI(0x148,'Tfs5')][lllilI(0x12a,'Ashl')](iil1iI));return i1ii[lllilI(0x1b4,'8)1!')]&&!iIli1l&&iI1ll1['EYRXN'](I1iIl1[lllilI(0x13e,'*lOR')],0x1)&&i1il[lllilI(0x1b1,'^HHJ')]&&i1i1II;}else{const IlIllI=lllilI(0x132,'#yS8')[lllilI(0x173,'ayO9')]('|');let il1i1I=0x0;while(!![]){switch(IlIllI[il1i1I++]){case'0':$[lllilI(0x1f9,'IXG#')]=![];continue;case'1':$[lllilI(0x1ea,'Rrv*')]&&(await $[lllilI(0x250,'#j5@')](0x3e8),IilIi1+=iI1lil,$[lllilI(0x255,'xd[k')]=$[lllilI(0x1c1,'&z*W')][lllilI(0x1cf,'Vu(b')](lI1li1=>!l1lIiI[lllilI(0x233,'5V#V')](lI1li1)),liIll=liIll[lllilI(0x14e,'^HHJ')](0x14));continue;case'2':await sendRequest('deleteCouponListApplet');continue;case'3':await $[lllilI(0x24f,'%f2E')](0x7d0);continue;case'4':console[lllilI(0x225,'Vu(b')]('开始去删除上述'+iI1lil+lllilI(0x23b,'%f2E'));continue;case'5':await $[lllilI(0x227,'cBc3')](0x7d0);continue;}break;}}}}else{console[lllilI(0x1c3,'&yEM')]('没有找到可删除的优惠券');break;}iI1liI++;if(iI1ll1[lllilI(0x153,'LZwb')](iI1liI,0x32)){console[lllilI(0x197,'dR7x')](lllilI(0x159,'!#cz'));break;}await $['wait'](0x7d0);}else l1lIlI['log'](lllilI(0x1fc,'FB]z')+IiiIl1+'\x20请求响应\x20'+(lIIil1[lllilI(0x172,'x!eR')]||IIli1));}console[lllilI(0x155,'ioup')](lllilI(0x20a,'*]je')+IilIi1+lllilI(0x1a4,'k0mX'));}else console[lllilI(0x1b2,'21IT')](iI1ll1[lllilI(0x235,'*lOR')]);}}else lllilI(0x15f,'lMB7')===iI1ll1[lllilI(0x12e,'&z*W')]?i1IIl['log']('❌\x20脚本运行遇到了错误\x0a'+I1lll1):console[lllilI(0x256,'xd[k')](lllilI(0x125,'rMzl'));}catch(ilil1i){console[lllilI(0x155,'ioup')](lllilI(0x223,'IXG#')+ilil1i);}}async function handleResponse(IlIIi,IiI1l){const IIIl11=i11il1,illlII={'RpbVx':'删除上述优惠券成功\x20✅','pWYUD':function(iIII11,IiI1i){return iIII11===IiI1i;},'TNQBS':function(llll1,lil11l){return llll1(lil11l);},'IyueY':IIIl11(0x1c0,'cBc3'),'kEFsZ':function(i1i1Il,I1lIl1){return i1i1Il!==I1lIl1;},'KUHxs':IIIl11(0x215,'5Eae'),'hzfuO':IIIl11(0x143,'ayO9')};try{switch(IlIIi){case IIIl11(0x1b9,'^HHJ'):illlII[IIIl11(0x17f,'^x)P')](IiI1l[IIIl11(0x224,'SO&F')],'0')?($[IIIl11(0x1d7,'iH&u')]=IiI1l['coupon'][IIIl11(0x195,'RtuP')]||[],$[IIIl11(0x1ec,'&z*W')]=illlII[IIIl11(0x1d3,'IXG#')](parseInt,IiI1l[IIIl11(0x1a2,'5Eae')]['useable_count']||0x0)):console['log'](IIIl11(0x182,'dR7x')+(IiI1l?.[IIIl11(0x13f,'k0mX')]||JSON['stringify'](IiI1l)));break;case illlII[IIIl11(0x1ee,'zuPu')]:IiI1l[IIIl11(0x139,'ioup')]===0x0?illlII['kEFsZ'](IIIl11(0x152,'k0mX'),illlII[IIIl11(0x24c,'&yEM')])?(Iii11I[IIIl11(0x186,'3wtw')]=!![],Iil1II['log'](illlII['RpbVx']),iIIl1I['message'][IIIl11(0x209,'*lOR')]('删除优惠券成功')):($[IIIl11(0x19f,'rMzl')]=!![],console[IIIl11(0x164,'RtuP')](IIIl11(0x130,'dR7x')),$[IIIl11(0x131,'3wtw')]['insert'](IIIl11(0x23a,'RtuP'))):(console[IIIl11(0x189,'iH&u')]('删除上述优惠券失败\x20=>\x20'+(IiI1l?.['errMsg']||JSON[IIIl11(0x1d6,'cY%h')](IiI1l))),$[IIIl11(0x1a3,'^x)P')]['insert'](IIIl11(0x1af,'cBc3')));break;}}catch(IlIIl){illlII[IIIl11(0x19a,'Cl[[')](IIIl11(0x188,'&yEM'),illlII[IIIl11(0x203,'5Eae')])?console[IIIl11(0x16f,'k0mX')]('❌\x20未能正确处理\x20'+IlIIi+IIIl11(0x1dd,'HSvD')+(IlIIl[IIIl11(0x237,'21IT')]||IlIIl)):i1illl[IIIl11(0x12f,'3wtw')](IIIl11(0x1bc,'k0mX')+(I1llil?.['errMsg']||I1llii[IIIl11(0x251,'21IT')](lilIll)));}}async function sendRequest(i1i1Ii){const I1lIi1=i11il1,lllii={'ZlpQx':I1lIi1(0x1b7,'*]je'),'TnlNA':I1lIi1(0x226,'RtuP'),'XXTBt':I1lIi1(0x242,'lMB7'),'kYTVU':I1lIi1(0x196,'Ashl'),'jUMZa':I1lIi1(0x218,'xd[k'),'TULZs':'deleteCouponListApplet','UFGEa':I1lIi1(0x1c8,'ThHF'),'kfmZU':I1lIi1(0x1d5,'cBc3'),'OsGCX':I1lIi1(0x21c,'Vu(b'),'JLzmi':'ajax','FTwog':'FzfzF','dCeid':'*/*','VBudg':I1lIi1(0x208,'iH&u'),'TaDqd':'empty','nwUMk':function(IiI1I,illlIl){return IiI1I===illlIl;},'LVhgM':function(i11ill,IIIIIi){return i11ill>=IIIIIi;}};if($[I1lIi1(0x18c,'&7u@')]||$[I1lIi1(0x1a5,'OJ!i')])return;let iI11Ii='',iIII1l=null,lllil=null,iI11Il=lllii[I1lIi1(0x1e2,'RtuP')],iIII1i={},iil1i1={};switch(i1i1Ii){case lllii[I1lIi1(0x193,'f#1j')]:iil1i1={'appId':I1lIi1(0x232,'&oGq'),'functionId':lllii['TnlNA'],'appid':I1lIi1(0x16b,'8)1!'),'body':{'bizModelCode':'6','externalLoginType':0x8,'bizModeClientType':'M','appId':lllii[I1lIi1(0x25b,'&7u@')],'token':'3852b12f8c4d869b7ed3e2b3c68c9436','tenantCode':lllii[I1lIi1(0x147,'(6Fb')],'sourceType':'h5_inter_myjd_couponlist','state':0x1,'wxadd':0x1,'filterswitch':0x1},'version':I1lIi1(0x11f,'3wtw'),'ua':I1lIi1(0x15d,'xd[k')},iIII1i=await H5st[I1lIi1(0x17d,'SO&F')](iil1i1),iI11Ii=lllii['jUMZa'],lllil=Object[I1lIi1(0x183,'OJ!i')]({},iIII1i['paramsData']);break;case lllii['TULZs']:iI11Ii=lllii[I1lIi1(0x249,'RtuP')],lllil={'appid':lllii[I1lIi1(0x1f7,'Ashl')],'functionId':I1lIi1(0x145,'HSvD'),'body':JSON[I1lIi1(0x1d6,'cY%h')]({'bizModelCode':'6','externalLoginType':0x8,'bizModeClientType':'M','appId':lllii['XXTBt'],'token':lllii[I1lIi1(0x177,'#j5@')],'tenantCode':lllii[I1lIi1(0x1bf,'k0mX')],'sourceType':lllii['OsGCX'],'couponinfolist':$['couponinfolist']}),'g_ty':lllii[I1lIi1(0x1a7,'f#1j')]};break;default:console[I1lIi1(0x13b,'#j5@')](I1lIi1(0x171,'iH&u')+i1i1Ii);return;}const il1i11={'_':Date[I1lIi1(0x141,'xd[k')](),'sceneval':0x2,'g_login_type':0x1,'callback':I1lIi1(0x1ad,'8Q1)'),'g_tk':0x7d97a518,'g_ty':'ls','appCode':I1lIi1(0x12b,'ThHF')};iIII1l&&Object[I1lIi1(0x230,'j4AO')](iIII1l,il1i11);lllil&&(lllii[I1lIi1(0x217,'zuPu')]===I1lIi1(0x133,'&z*W')?Object[I1lIi1(0x178,'Vu(b')](lllil,il1i11):IiiIlI['assign'](Iilli1,I1l1Il));const IlIll1={'url':iI11Ii,'method':iI11Il,'headers':{'Accept':[lllii[I1lIi1(0x22b,'x!eR')],'deleteCouponListApplet']['includes'](i1i1Ii)?I1lIi1(0x252,'x!eR'):lllii[I1lIi1(0x21a,'ioup')],'Accept-Encoding':'gzip,\x20deflate,\x20br','Accept-Language':lllii[I1lIi1(0x1d8,'!#cz')],'Connection':I1lIi1(0x169,'&yEM'),'Content-Type':I1lIi1(0x247,'8)1!'),'Cookie':cookie,'Origin':'https://wqs.jd.com','Referer':'https://wqs.jd.com/','Sec-Fetch-Dest':lllii[I1lIi1(0x212,'2p03')],'Sec-Fetch-Mode':I1lIi1(0x19b,'lMB7'),'Sec-Fetch-Site':I1lIi1(0x1ed,'&7u@'),'User-Agent':I1lIi1(0x146,'zuPu')},'params':lllil,'data':iIII1l,'timeout':0x7530,'httpsTlsOptions':[I1lIi1(0x184,'Rrv*')][I1lIi1(0x1eb,'xd[k')](i1i1Ii)?common['useAppTls']():null};lllii[I1lIi1(0x228,'IXG#')](iI11Il,I1lIi1(0x23d,'iH&u'))&&(delete IlIll1[I1lIi1(0x194,'(6Fb')],delete IlIll1['headers'][I1lIi1(0x253,'ThHF')]);const IlIII=0x1;let ilil1l=0x0,illlIi=null,I1lIii=![];while(ilil1l<IlIII){ilil1l>0x0&&await $[I1lIi1(0x24f,'%f2E')](0x3e8);const I1lIil=await common['request'](IlIll1);if(!I1lIil[I1lIi1(0x15b,'^HHJ')]){illlIi='🚫\x20'+i1i1Ii+'\x20请求失败\x20➜\x20'+I1lIil[I1lIi1(0x1f6,'aKps')],ilil1l++;I1lIil[I1lIi1(0x137,'&z*W')]&&I1lIil[I1lIi1(0x23e,'RtuP')]===0x193&&($['skipRun']=!![]);continue;}if(!I1lIil['data']){illlIi='🚫\x20'+i1i1Ii+I1lIi1(0x1d1,'xd[k'),ilil1l++;continue;}await handleResponse(i1i1Ii,I1lIil['data']),I1lIii=![];break;}lllii[I1lIi1(0x19e,'&7u@')](ilil1l,IlIII)&&(console[I1lIi1(0x164,'RtuP')](illlIi),I1lIii&&($[I1lIi1(0x1fe,'#yS8')]=!![],$['message']&&$[I1lIi1(0x1e9,'lMB7')]['fix'](illlIi)));}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t, e) { "undefined" != typeof process && JSON.stringify(process.env).indexOf("GITHUB") > -1 && process.exit(0); class s { constructor(t) { this.env = t } send(t, e = "GET") { t = "string" == typeof t ? { url: t } : t; let s = this.get; return "POST" === e && (s = this.post), new Promise((e, i) => { s.call(this, t, (t, s, r) => { t ? i(t) : e(s) }) }) } get(t) { return this.send.call(this.env, t) } post(t) { return this.send.call(this.env, t, "POST") } } return new class { constructor(t, e) { this.name = t, this.http = new s(this), this.data = null, this.dataFile = "box.dat", this.logs = [], this.isMute = !1, this.isNeedRewrite = !1, this.logSeparator = "\n", this.startTime = (new Date).getTime(), Object.assign(this, e), this.log("", `🔔${this.name}, 开始!`) } isNode() { return "undefined" != typeof module && !!module.exports } isQuanX() { return "undefined" != typeof $task } isSurge() { return "undefined" != typeof $httpClient && "undefined" == typeof $loon } isLoon() { return "undefined" != typeof $loon } toObj(t, e = null) { try { return JSON.parse(t) } catch { return e } } toStr(t, e = null) { try { return JSON.stringify(t) } catch { return e } } getjson(t, e) { let s = e; const i = this.getdata(t); if (i) try { s = JSON.parse(this.getdata(t)) } catch { } return s } setjson(t, e) { try { return this.setdata(JSON.stringify(t), e) } catch { return !1 } } getScript(t) { return new Promise(e => { this.get({ url: t }, (t, s, i) => e(i)) }) } runScript(t, e) { return new Promise(s => { let i = this.getdata("@chavy_boxjs_userCfgs.httpapi"); i = i ? i.replace(/\n/g, "").trim() : i; let r = this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout"); r = r ? 1 * r : 20, r = e && e.timeout ? e.timeout : r; const [o, h] = i.split("@"), n = { url: `http://${h}/v1/scripting/evaluate`, body: { script_text: t, mock_type: "cron", timeout: r }, headers: { "X-Key": o, Accept: "*/*" } }; this.post(n, (t, e, i) => s(i)) }).catch(t => this.logErr(t)) } loaddata() { if (!this.isNode()) return {}; { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e); if (!s && !i) return {}; { const i = s ? t : e; try { return JSON.parse(this.fs.readFileSync(i)) } catch (t) { return {} } } } } writedata() { if (this.isNode()) { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e), r = JSON.stringify(this.data); s ? this.fs.writeFileSync(t, r) : i ? this.fs.writeFileSync(e, r) : this.fs.writeFileSync(t, r) } } lodash_get(t, e, s) { const i = e.replace(/\[(\d+)\]/g, ".$1").split("."); let r = t; for (const t of i) if (r = Object(r)[t], void 0 === r) return s; return r } lodash_set(t, e, s) { return Object(t) !== t ? t : (Array.isArray(e) || (e = e.toString().match(/[^.[\]]+/g) || []), e.slice(0, -1).reduce((t, s, i) => Object(t[s]) === t[s] ? t[s] : t[s] = Math.abs(e[i + 1]) >> 0 == +e[i + 1] ? [] : {}, t)[e[e.length - 1]] = s, t) } getdata(t) { let e = this.getval(t); if (/^@/.test(t)) { const [, s, i] = /^@(.*?)\.(.*?)$/.exec(t), r = s ? this.getval(s) : ""; if (r) try { const t = JSON.parse(r); e = t ? this.lodash_get(t, i, "") : e } catch (t) { e = "" } } return e } setdata(t, e) { let s = !1; if (/^@/.test(e)) { const [, i, r] = /^@(.*?)\.(.*?)$/.exec(e), o = this.getval(i), h = i ? "null" === o ? null : o || "{}" : "{}"; try { const e = JSON.parse(h); this.lodash_set(e, r, t), s = this.setval(JSON.stringify(e), i) } catch (e) { const o = {}; this.lodash_set(o, r, t), s = this.setval(JSON.stringify(o), i) } } else s = this.setval(t, e); return s } getval(t) { return this.isSurge() || this.isLoon() ? $persistentStore.read(t) : this.isQuanX() ? $prefs.valueForKey(t) : this.isNode() ? (this.data = this.loaddata(), this.data[t]) : this.data && this.data[t] || null } setval(t, e) { return this.isSurge() || this.isLoon() ? $persistentStore.write(t, e) : this.isQuanX() ? $prefs.setValueForKey(t, e) : this.isNode() ? (this.data = this.loaddata(), this.data[e] = t, this.writedata(), !0) : this.data && this.data[e] || null } initGotEnv(t) { this.got = this.got ? this.got : require("got"), this.cktough = this.cktough ? this.cktough : require("tough-cookie"), this.ckjar = this.ckjar ? this.ckjar : new this.cktough.CookieJar, t && (t.headers = t.headers ? t.headers : {}, void 0 === t.headers.Cookie && void 0 === t.cookieJar && (t.cookieJar = this.ckjar)) } get(t, e = (() => { })) { t.headers && (delete t.headers["Content-Type"], delete t.headers["Content-Length"]), this.isSurge() || this.isLoon() ? (this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.get(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) })) : this.isQuanX() ? (this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t))) : this.isNode() && (this.initGotEnv(t), this.got(t).on("redirect", (t, e) => { try { if (t.headers["set-cookie"]) { const s = t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString(); s && this.ckjar.setCookieSync(s, null), e.cookieJar = this.ckjar } } catch (t) { this.logErr(t) } }).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) })) } post(t, e = (() => { })) { if (t.body && t.headers && !t.headers["Content-Type"] && (t.headers["Content-Type"] = "application/x-www-form-urlencoded"), t.headers && delete t.headers["Content-Length"], this.isSurge() || this.isLoon()) this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.post(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) }); else if (this.isQuanX()) t.method = "POST", this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t)); else if (this.isNode()) { this.initGotEnv(t); const { url: s, ...i } = t; this.got.post(s, i).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) }) } } time(t, e = null) { const s = e ? new Date(e) : new Date; let i = { "M+": s.getMonth() + 1, "d+": s.getDate(), "H+": s.getHours(), "m+": s.getMinutes(), "s+": s.getSeconds(), "q+": Math.floor((s.getMonth() + 3) / 3), S: s.getMilliseconds() }; /(y+)/.test(t) && (t = t.replace(RegExp.$1, (s.getFullYear() + "").substr(4 - RegExp.$1.length))); for (let e in i) new RegExp("(" + e + ")").test(t) && (t = t.replace(RegExp.$1, 1 == RegExp.$1.length ? i[e] : ("00" + i[e]).substr(("" + i[e]).length))); return t } msg(e = t, s = "", i = "", r) { const o = t => { if (!t) return t; if ("string" == typeof t) return this.isLoon() ? t : this.isQuanX() ? { "open-url": t } : this.isSurge() ? { url: t } : void 0; if ("object" == typeof t) { if (this.isLoon()) { let e = t.openUrl || t.url || t["open-url"], s = t.mediaUrl || t["media-url"]; return { openUrl: e, mediaUrl: s } } if (this.isQuanX()) { let e = t["open-url"] || t.url || t.openUrl, s = t["media-url"] || t.mediaUrl; return { "open-url": e, "media-url": s } } if (this.isSurge()) { let e = t.url || t.openUrl || t["open-url"]; return { url: e } } } }; if (this.isMute || (this.isSurge() || this.isLoon() ? $notification.post(e, s, i, o(r)) : this.isQuanX() && $notify(e, s, i, o(r))), !this.isMuteLog) { let t = ["", "==============📣系统通知📣=============="]; t.push(e), s && t.push(s), i && t.push(i), console.log(t.join("\n")), this.logs = this.logs.concat(t) } } log(...t) { t.length > 0 && (this.logs = [...this.logs, ...t]), console.log(t.join(this.logSeparator)) } logErr(t, e) { const s = !this.isSurge() && !this.isQuanX() && !this.isLoon(); s ? this.log("", `❗️${this.name}, 错误!`, t.stack) : this.log("", `❗️${this.name}, 错误!`, t) } wait(t) { return new Promise(e => setTimeout(e, t)) } done(t = {}) { const e = (new Date).getTime(), s = (e - this.startTime) / 1e3; this.log("", `🔔${this.name}, 结束! 🕛 ${s} 秒`), this.log(), (this.isSurge() || this.isQuanX() || this.isLoon()) && $done(t) } }(t, e) }
