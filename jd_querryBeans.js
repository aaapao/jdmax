/*
当日收支查询
环境变量：jd_querryBeans_notify // 是否推送通知（true/false），默认不推送

1 1 1 1 *

*/

const $ = new Env('当日收支查询')
function _0x379f(_0x5abbdc,_0x32ae32){const _0x1cd46b=_0x1cd4();return _0x379f=function(_0x379ffd,_0x354ab3){_0x379ffd=_0x379ffd-0xc7;let _0x579c4f=_0x1cd46b[_0x379ffd];if(_0x379f['nwofhN']===undefined){var _0x53e2e9=function(_0x5d1a70){const _0x2dcc60='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x55b33c='',_0x342ed9='';for(let _0x4515fa=0x0,_0xd70303,_0x32e95f,_0xf00196=0x0;_0x32e95f=_0x5d1a70['charAt'](_0xf00196++);~_0x32e95f&&(_0xd70303=_0x4515fa%0x4?_0xd70303*0x40+_0x32e95f:_0x32e95f,_0x4515fa++%0x4)?_0x55b33c+=String['fromCharCode'](0xff&_0xd70303>>(-0x2*_0x4515fa&0x6)):0x0){_0x32e95f=_0x2dcc60['indexOf'](_0x32e95f);}for(let _0x26ea32=0x0,_0x2d0fdb=_0x55b33c['length'];_0x26ea32<_0x2d0fdb;_0x26ea32++){_0x342ed9+='%'+('00'+_0x55b33c['charCodeAt'](_0x26ea32)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x342ed9);};const _0x1913f6=function(_0x5424a7,_0xf90899){let _0x3bcf1f=[],_0x53df67=0x0,_0x1ad57e,_0x40b155='';_0x5424a7=_0x53e2e9(_0x5424a7);let _0x1010df;for(_0x1010df=0x0;_0x1010df<0x100;_0x1010df++){_0x3bcf1f[_0x1010df]=_0x1010df;}for(_0x1010df=0x0;_0x1010df<0x100;_0x1010df++){_0x53df67=(_0x53df67+_0x3bcf1f[_0x1010df]+_0xf90899['charCodeAt'](_0x1010df%_0xf90899['length']))%0x100,_0x1ad57e=_0x3bcf1f[_0x1010df],_0x3bcf1f[_0x1010df]=_0x3bcf1f[_0x53df67],_0x3bcf1f[_0x53df67]=_0x1ad57e;}_0x1010df=0x0,_0x53df67=0x0;for(let _0x23e3e9=0x0;_0x23e3e9<_0x5424a7['length'];_0x23e3e9++){_0x1010df=(_0x1010df+0x1)%0x100,_0x53df67=(_0x53df67+_0x3bcf1f[_0x1010df])%0x100,_0x1ad57e=_0x3bcf1f[_0x1010df],_0x3bcf1f[_0x1010df]=_0x3bcf1f[_0x53df67],_0x3bcf1f[_0x53df67]=_0x1ad57e,_0x40b155+=String['fromCharCode'](_0x5424a7['charCodeAt'](_0x23e3e9)^_0x3bcf1f[(_0x3bcf1f[_0x1010df]+_0x3bcf1f[_0x53df67])%0x100]);}return _0x40b155;};_0x379f['hSRVgt']=_0x1913f6,_0x5abbdc=arguments,_0x379f['nwofhN']=!![];}const _0x4f3a48=_0x1cd46b[0x0],_0x4f05f9=_0x379ffd+_0x4f3a48,_0x2e25ca=_0x5abbdc[_0x4f05f9];return!_0x2e25ca?(_0x379f['UOyniX']===undefined&&(_0x379f['UOyniX']=!![]),_0x579c4f=_0x379f['hSRVgt'](_0x579c4f,_0x354ab3),_0x5abbdc[_0x4f05f9]=_0x579c4f):_0x579c4f=_0x2e25ca,_0x579c4f;},_0x379f(_0x5abbdc,_0x32ae32);}function _0x1cd4(){const _0x4456b2=['W77dTmk8fSoFWQFcUH8Cluj5zdO','WPzgdq','CHz6W5pdOMZcQKFcUCkJW5/cUW','aJhcJ8kC','wKJcIqxcRbtcVq','iCodW7ldS8kfcL3cT8k8aIG','WR7dOmkrWQ9GWR3cLSksWP7cImk7sCkj','W7TAe1m','zqvVW5hdT0lcRG','WOfWW5K','A+kCRSo5','W5JcRmolW5C','pmotW7NdPSkdgW','w2ddGSkwhmks','oCoyW7pdPmkp','W5yth0f1W6VdOCoyW5q','W4RdHMLdWRm0ymojn053WQO','Cd8KpIWzWOi','vwldJSonWQTWWQvcdSoQ','WPvChIxdPmkeW4m','W6epW4FcPmoBW4hdOSoiW5LftZPqvq','W5tdJCkaW4m','Amk5g3BcQ8okWRVdMbRcLe0vkreDsSktktxdT8oxxgZcUrZdOGuQWPVcI3yBEgpdNSkrC8oSACkqW5BdJCkZWOe','xMddL8kYhCk/jSkSW7JdUW','WPzQWQTX','W7NdKCkbWRSSW68','Da9XW5VdV0y','iSkNp8oFhCoWwG','yCoWF8oEkSouwmoJW4C','ke1xqCoGWQSMBCkcW57dHH03pNWBsCozW5tdMmoFrCkOquFcMCoG','W6NcRN/dTmoeWRFdG8otWOTT','vSk/dX4','WPXabaldPmkjW50','qHn6W4/dMedcPLe','A+ITHEAYM+wLLoI3V0NINAKe','cmkMW5i6','imoxW7ddPmk5bNu','lNXnW7tcUaO0WQCSW6dcRLOvWPtcQmkuBq','WQPfW6O8W7H9wSkmW7BdS10VgSk0W5LzCSooWOGLqmoiWQNcTb/dKbBcMmkLWOL4W47dOW','rmowW7BcM2LylG','Ccmhrq','zGFdOCkSiCkF','gCklWQ7dIt5ImmocwSktBW','oNjfW7ddOvK','t+ISJ+AWGEwKHEI1T8oS4P2yWRVMLB7LK4FLUOpMLBBMJza','umk7gHhdUqldNCoYWRO1','ar4OnXa0k8kWlmo3W7q','5lUC5Pw25Pwt5yszWPy','AWDrrSoOWQaW','uCoJkmopWPVcGSonwW','t2tdM8k5Dmk1imkKW7BdVKu','bCkXkSobmSoYuSoR','jmo3W5ZcTh7dS8kmWRhcJa','W6JdUSo/','WQxdPgVdRSoPWR7dHmkDWRbKW5ORWPa8WP53WQhdQLtcU1tdQ8oh','D8olW78','e8o4bsVcMa','m8oxW6pdOSkF','W7jEfevTWP1A','wSobCWbJW7tcRCo1W458wvm','zCkpWQFcTCogs3hcQ8kEgXtcLG','CcKCxSo6','W6VdHMHBWRm7EG','mwHHyIGyWOBcI3/dPa','ESoZWP0','WQW8WPy','W5dcG8k9WPjx','l8owWPNcLJdcJmkMW5m','jos5MUAwQoAwKUweR++/Uq','zFgbKQau6l6c6kka57Ix5PYhWPq','AxBdK8kUf8k7p8kO','DCkbWO3cRG','oHRcMq','z8o0WQxdTdZdSW','W7ZdK8kaWQS','5lUa5PsT5Ps15ywifq','WOddISoxquC','dwDoWPtcUWlcMCokca','pmozW7a','W4JdNCkDW4ZcNqG','ugRdKq','WO96WPrWWPOY','WOvnrfLzW60','xSoklN82WQ/cNCov','WPBcI8odWP3dMq3dMb0BWQGJ','wt0wWO3cNai','W7ddUmkMemoYWQ7cGHCgnq','uXfhr8ohWQy4jW','CCk4cNtcQSkjW5hcHqRcNL4','W6RdTmo1uq','e8o4hZtcNmkt','l8ovW4tdQ2tdMCohW7NcK8odW6tcRCko','W5/cO8ovW5CHW6S','W6uAW7a0W5jXvmktW7BdUq','WQOdxGa+WRjsrxddOrC','yXrhw8o9WOO0mCkJW5RdGX0','w0lcNq','yCoMkmotWQhcRSobtrVcUSouWOG','W7Xufuu','W6tdJhreWRC9Cq','W7ddSmoRqa','WPz7W4a','mCkVimogeSoN','W4VcKmo0','WPrbteL5W6ZdJW','nCkMkSoXWOBcQ8olza','W6RcVmoy','W6JdHgHcWRGU','WP/dLCoC','6lsG5y6v5PEc5Pw9','a8kxja','aIRcTd3cMSoJ','4PYJW5JMNANOG4NMRlhNOQlLP4dNKP3cVG','ttekWPxcMbpcVW','5lUo5Pw15PwI5ywhW7u','WRxcPSkHamkEWOxcSGJcL8kGxSoYg0S','WO59W4RdMW','W5xcOSocW5C','o8o6m0bJWR4fCmk/','WRqtyG','WPxcJSkuW6FcUIJdNte','4PYBWQpOHRtMN7hOV4dOO5JPGQlLI6FKUBpPL6JORiVcOG','uCkXhXO','DtS9jG','j8oDWR4','WQBdV8kkWRf4WQdcQa','5P+A6k625B245BUb','dSkYW548eSoNuCkjuZZcUG','ESkfWOdcUa','W6HAdKi','quHPDeuQmq','zmkSg2m','gmkdWQtcH1vok8odua','W7JcRMRdMCoVWR3dNmoBWOC','8yoOKCkB','EI4AD8oKWOBdQq','AWns','fthcRa','BJuZfZ8i','CCo+pSoyWQhcOmopuqpcSSow'];_0x1cd4=function(){return _0x4456b2;};return _0x1cd4();}const _0x34c905=_0x379f;(function(_0x4d7843,_0x298379){const _0x4c9027=_0x379f,_0x8f8789=_0x4d7843();while(!![]){try{const _0x12999b=parseInt(_0x4c9027(0x152,'hEhv'))/0x1*(parseInt(_0x4c9027(0x10d,'whkt'))/0x2)+-parseInt(_0x4c9027(0x109,'7X4E'))/0x3+parseInt(_0x4c9027(0x129,'^SFZ'))/0x4+-parseInt(_0x4c9027(0x144,'P9VE'))/0x5*(-parseInt(_0x4c9027(0x12c,'G^zq'))/0x6)+-parseInt(_0x4c9027(0xd4,'akQ9'))/0x7*(-parseInt(_0x4c9027(0x146,'RvP#'))/0x8)+-parseInt(_0x4c9027(0x11b,'4D0#'))/0x9*(parseInt(_0x4c9027(0xfc,']%jr'))/0xa)+-parseInt(_0x4c9027(0x141,'rg$R'))/0xb*(parseInt(_0x4c9027(0x111,'^SFZ'))/0xc);if(_0x12999b===_0x298379)break;else _0x8f8789['push'](_0x8f8789['shift']());}catch(_0x3be149){_0x8f8789['push'](_0x8f8789['shift']());}}}(_0x1cd4,0x581a9));const jdCookie=require(_0x34c905(0x12b,'Dr4)')),notify=require(_0x34c905(0xeb,'4oMI')),common=require(_0x34c905(0x104,'rN!W')),isNotify=process[_0x34c905(0xcb,'[aJ1')]['jd_querryBeans_notify']==='true',todayString=$[_0x34c905(0x142,'9DQC')]('yyyy-MM-dd',Date[_0x34c905(0x145,'fZ^A')]());let cookie='';const cookiesArr=Object[_0x34c905(0x115,'^SFZ')](jdCookie)[_0x34c905(0xca,'4oMI')](_0x1913f6=>jdCookie[_0x1913f6])[_0x34c905(0x123,'4D0#')](_0x5d1a70=>_0x5d1a70);!cookiesArr[0x0]&&($[_0x34c905(0x10e,'UX5q')]($[_0x34c905(0xd9,'WKFP')],'【提示】请先获取Cookie'),process[_0x34c905(0xf6,'KYbb')](0x1));!(async()=>{const _0x2dc41a=_0x34c905;$[_0x2dc41a(0x11f,'K9dO')]=[],notify[_0x2dc41a(0xe8,'GwzE')]({'title':$[_0x2dc41a(0x127,'rg$R')]});for(let _0x55b33c=0x0;_0x55b33c<cookiesArr[_0x2dc41a(0xf7,'rFtY')];_0x55b33c++){$[_0x2dc41a(0xdc,'XHPt')]=_0x55b33c+0x1,cookie=cookiesArr[_0x55b33c],common[_0x2dc41a(0xc7,'rN!W')](cookie),$[_0x2dc41a(0x125,'4oMI')]=decodeURIComponent(common[_0x2dc41a(0xe2,'VAYF')](cookie,_0x2dc41a(0x117,'UX5q'))),$['UA']=common[_0x2dc41a(0x106,'qwhY')]($[_0x2dc41a(0xef,'GwzE')]),$['message']=notify['create']($['index'],$[_0x2dc41a(0xff,'BkJA')]),$['nickName']='',console[_0x2dc41a(0x103,'rg$R')]('\x0a******开始【京东账号'+$['index']+'】'+($['nickName']||$[_0x2dc41a(0x101,'D$uC')])+_0x2dc41a(0x14b,'akQ9')),$[_0x2dc41a(0xd7,'Dr4)')]=common[_0x2dc41a(0x128,'qwhY')]($[_0x2dc41a(0x114,'y07m')]),$['JEH']=common[_0x2dc41a(0xdb,'y07m')](),await Main(),common[_0x2dc41a(0xcd,'BkJA')]();if($[_0x2dc41a(0x13d,'[aJ1')])break;await $[_0x2dc41a(0xf1,'%S$6')](0x3e8);}const _0x2dcc60=notify['getMessage']();_0x2dcc60&&(console[_0x2dc41a(0x12e,'CvFG')](_0x2dc41a(0x113,'7X4E')+_0x2dcc60[_0x2dc41a(0xdf,'whkt')](/：/,_0x2dc41a(0xd8,'nc#c'))),isNotify&&await notify[_0x2dc41a(0xe3,'RvP#')]());})()[_0x34c905(0x107,'XHPt')](_0x342ed9=>$[_0x34c905(0xcc,'whkt')](_0x342ed9))[_0x34c905(0xee,'BHTj')](()=>$[_0x34c905(0x118,'PAhY')]());async function Main(){const _0x1ca455=_0x34c905;try{$[_0x1ca455(0xd3,'XHPt')]=![];const _0x4515fa=await common['getLoginStatus'](cookie);if(!_0x4515fa&&typeof _0x4515fa===_0x1ca455(0x10c,'BBH[')){console[_0x1ca455(0x14a,'nc#c')](_0x1ca455(0x13b,'4oMI'));return;}let _0xd70303=new Map();_0x369728:for(let _0x5424a7=0x1;_0x5424a7<=0x14;_0x5424a7++){$[_0x1ca455(0x136,'jq(F')]=''+_0x5424a7,$[_0x1ca455(0x124,'keYU')]=[],await sendRequest(_0x1ca455(0xe5,'y07m'));const _0xf90899=$[_0x1ca455(0x124,'keYU')];if(_0xf90899[_0x1ca455(0xda,'XHPt')]===0x0)break;for(let _0x3bcf1f of _0xf90899){let _0x53df67=_0x3bcf1f[_0x1ca455(0x151,'fy#8')][_0x1ca455(0x11a,'&qSm')]('\x20')[0x0];if(_0x53df67===todayString)_0x3bcf1f[_0x1ca455(0x139,'BBH[')]=parseInt(_0x3bcf1f[_0x1ca455(0x134,'D$uC')]),_0xd70303[_0x3bcf1f[_0x1ca455(0xd0,'GwzE')]]?(_0xd70303[_0x3bcf1f[_0x1ca455(0x12d,'4oMI')]][_0x1ca455(0xe7,'PAhY')]+=_0x3bcf1f[_0x1ca455(0x120,'jq(F')],new Date(_0xd70303[_0x3bcf1f['eventMassage']][_0x1ca455(0xd5,'G^zq')])<new Date(_0x3bcf1f['date'])&&(_0xd70303[_0x3bcf1f['eventMassage']]['date']=_0x3bcf1f[_0x1ca455(0x14e,'^SFZ')])):_0xd70303[_0x3bcf1f[_0x1ca455(0x12f,'BkJA')]]={..._0x3bcf1f};else break _0x369728;}$[_0x1ca455(0x14f,'G^zq')](0x3e8);}const _0x32e95f=Object['values'](_0xd70303);let _0xf00196=0x0,_0x26ea32=0x0,_0x2d0fdb=[];if(_0x32e95f[_0x1ca455(0x11d,'RvP#')]>0x0){for(const _0x40b155 of _0x32e95f){let {date:_0x1010df,amount:_0x23e3e9,eventMassage:_0x2dea9c}=_0x40b155;_0x23e3e9>0x0?_0xf00196+=_0x23e3e9:_0x26ea32+=_0x23e3e9,_0x2dea9c=_0x2dea9c['replace'](/（商品:.*）/g,'')[_0x1ca455(0xd6,'GwzE')](/订单.*使用京豆.*个/g,'订单使用京豆'),/参加\[.*\].*-奖励/[_0x1ca455(0x132,'rg$R')](_0x2dea9c)&&(_0x2dea9c=_0x2dea9c[_0x1ca455(0xe9,'D$uC')](/参加\[/g,'')[_0x1ca455(0x13f,'4D0#')](/\].*/g,'')),_0x1010df=_0x1010df['split']('\x20')[0x1],_0x2d0fdb[_0x1ca455(0xe6,'K9dO')]({'时间':_0x1010df,'渠道':_0x2dea9c,'明细':_0x23e3e9});}console[_0x1ca455(0x110,'Qc)s')](_0x2d0fdb);const _0x1ad57e=_0xf00196+_0x26ea32;console[_0x1ca455(0x11c,'XHPt')](_0x1ca455(0xfd,'ViIe')+_0xf00196+_0x1ca455(0x112,'BkJA')+_0x26ea32),$['message']['insert'](_0x1ca455(0x119,'P9VE')+_0xf00196),$[_0x1ca455(0xfe,'4oMI')][_0x1ca455(0x12a,'WKFP')](_0x1ca455(0x140,'BkJA')+_0x26ea32);}else!$[_0x1ca455(0x14d,'%S$6')]&&console[_0x1ca455(0x11e,'y07m')]('未查询到今日京豆变动明细数据，快去参与活动获取吧~');}catch(_0x29e23e){console['log'](_0x1ca455(0x147,'Yw9C')+_0x29e23e);}}async function handleResponse(_0xff1cff,_0x4e75c0){const _0x1a2502=_0x34c905;try{switch(_0xff1cff){case _0x1a2502(0xec,'rN!W'):if(_0x4e75c0[_0x1a2502(0x148,'woDY')]==='0')$['detailList']=_0x4e75c0[_0x1a2502(0xce,'keYU')];else _0x4e75c0[_0x1a2502(0x143,'WKFP')]==='1'?console[_0x1a2502(0x13a,'&qSm')](_0x1a2502(0x14c,'4D0#')):console[_0x1a2502(0x133,'9DQC')]('❓'+_0xff1cff+'\x20'+JSON[_0x1a2502(0x102,'Yw9C')](_0x4e75c0));break;}}catch(_0x26a269){console[_0x1a2502(0x10f,'cG&s')](_0x1a2502(0x13e,'7X4E')+_0xff1cff+'\x20请求响应\x20'+(_0x26a269[_0x1a2502(0xd2,'CvFG')]||_0x26a269));}}async function sendRequest(_0x56c044){const _0x1f67c2=_0x34c905;if($['runEnd']||$[_0x1f67c2(0xe1,'BHTj')])return;let _0x5372c5='',_0x407a4a=null,_0x943722=null,_0x3025e9=_0x1f67c2(0x105,'u!eR');switch(_0x56c044){case _0x1f67c2(0xfb,'woDY'):_0x5372c5=_0x1f67c2(0xe4,'fy#8'),_0x943722={'page':$[_0x1f67c2(0xf2,'XHPt')]};break;default:console[_0x1f67c2(0xcf,'BHTj')]('❌\x20未知请求\x20'+_0x56c044);return;}const _0x2be732={'url':_0x5372c5,'method':_0x3025e9,'headers':{'Accept':_0x1f67c2(0xf4,'Dr4)'),'Accept-Encoding':_0x1f67c2(0xf3,'5j4]'),'Accept-Language':'zh-Hans-CN;q=1,\x20zh-Hant-CN;q=0.9,\x20en-CN;q=0.8','Connection':'keep-alive','Content-Type':'application/x-www-form-urlencoded','J-E-H':$['JEH'],'J-E-C':$[_0x1f67c2(0x116,'[aJ1')],'Cookie':cookie,'Sec-Fetch-Dest':'empty','Sec-Fetch-Mode':_0x1f67c2(0x130,'G^zq'),'Sec-Fetch-Site':_0x1f67c2(0x100,'y07m'),'User-Agent':$['UA']},'params':_0x943722,'data':_0x407a4a,'timeout':0x7530};_0x3025e9===_0x1f67c2(0x135,'akQ9')&&(delete _0x2be732[_0x1f67c2(0xed,'woDY')],delete _0x2be732[_0x1f67c2(0xf5,'hEhv')][_0x1f67c2(0xde,'BBH[')]);const _0x47b5e8=0x1;let _0x1b6dcf=0x0,_0x4b9207=null,_0x5d1655=![];while(_0x1b6dcf<_0x47b5e8){_0x1b6dcf>0x0&&await $[_0x1f67c2(0x149,'whkt')](0x3e8);const _0x2e05bb=await common[_0x1f67c2(0x150,']%jr')](_0x2be732);if(!_0x2e05bb['success']){_0x4b9207=_0x1f67c2(0xc8,'&qSm')+_0x56c044+_0x1f67c2(0xf0,'nc#c')+_0x2e05bb[_0x1f67c2(0x10b,'KYbb')],_0x1b6dcf++;_0x2e05bb[_0x1f67c2(0xf9,'5j4]')]&&_0x2e05bb[_0x1f67c2(0xf9,'5j4]')]===0x193&&($[_0x1f67c2(0x126,'fy#8')]=!![]);continue;}if(!_0x2e05bb[_0x1f67c2(0xd1,'xhE8')]){_0x4b9207='🚫\x20'+_0x56c044+_0x1f67c2(0xfa,'7X4E'),_0x1b6dcf++;continue;}await handleResponse(_0x56c044,_0x2e05bb[_0x1f67c2(0xd1,'xhE8')]),_0x5d1655=![];break;}_0x1b6dcf>=_0x47b5e8&&(console[_0x1f67c2(0x13c,'7X4E')](_0x4b9207),_0x5d1655&&($[_0x1f67c2(0xc9,'KYbb')]=!![],$[_0x1f67c2(0x108,'G^zq')]&&$[_0x1f67c2(0x131,'BBH[')][_0x1f67c2(0x138,'akQ9')](_0x4b9207)));}

// prettier-ignore
function Env(t, e) { "undefined" != typeof process && JSON.stringify(process.env).indexOf("GITHUB") > -1 && process.exit(0); class s { constructor(t) { this.env = t } send(t, e = "GET") { t = "string" == typeof t ? { url: t } : t; let s = this.get; return "POST" === e && (s = this.post), new Promise((e, i) => { s.call(this, t, (t, s, r) => { t ? i(t) : e(s) }) }) } get(t) { return this.send.call(this.env, t) } post(t) { return this.send.call(this.env, t, "POST") } } return new class { constructor(t, e) { this.name = t, this.http = new s(this), this.data = null, this.dataFile = "box.dat", this.logs = [], this.isMute = !1, this.isNeedRewrite = !1, this.logSeparator = "\n", this.startTime = (new Date).getTime(), Object.assign(this, e), this.log("", `🔔${this.name}, 开始!`) } isNode() { return "undefined" != typeof module && !!module.exports } isQuanX() { return "undefined" != typeof $task } isSurge() { return "undefined" != typeof $httpClient && "undefined" == typeof $loon } isLoon() { return "undefined" != typeof $loon } toObj(t, e = null) { try { return JSON.parse(t) } catch { return e } } toStr(t, e = null) { try { return JSON.stringify(t) } catch { return e } } getjson(t, e) { let s = e; const i = this.getdata(t); if (i) try { s = JSON.parse(this.getdata(t)) } catch { } return s } setjson(t, e) { try { return this.setdata(JSON.stringify(t), e) } catch { return !1 } } getScript(t) { return new Promise(e => { this.get({ url: t }, (t, s, i) => e(i)) }) } runScript(t, e) { return new Promise(s => { let i = this.getdata("@chavy_boxjs_userCfgs.httpapi"); i = i ? i.replace(/\n/g, "").trim() : i; let r = this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout"); r = r ? 1 * r : 20, r = e && e.timeout ? e.timeout : r; const [o, h] = i.split("@"), n = { url: `http://${h}/v1/scripting/evaluate`, body: { script_text: t, mock_type: "cron", timeout: r }, headers: { "X-Key": o, Accept: "*/*" } }; this.post(n, (t, e, i) => s(i)) }).catch(t => this.logErr(t)) } loaddata() { if (!this.isNode()) return {}; { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e); if (!s && !i) return {}; { const i = s ? t : e; try { return JSON.parse(this.fs.readFileSync(i)) } catch (t) { return {} } } } } writedata() { if (this.isNode()) { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e), r = JSON.stringify(this.data); s ? this.fs.writeFileSync(t, r) : i ? this.fs.writeFileSync(e, r) : this.fs.writeFileSync(t, r) } } lodash_get(t, e, s) { const i = e.replace(/\[(\d+)\]/g, ".$1").split("."); let r = t; for (const t of i) if (r = Object(r)[t], void 0 === r) return s; return r } lodash_set(t, e, s) { return Object(t) !== t ? t : (Array.isArray(e) || (e = e.toString().match(/[^.[\]]+/g) || []), e.slice(0, -1).reduce((t, s, i) => Object(t[s]) === t[s] ? t[s] : t[s] = Math.abs(e[i + 1]) >> 0 == +e[i + 1] ? [] : {}, t)[e[e.length - 1]] = s, t) } getdata(t) { let e = this.getval(t); if (/^@/.test(t)) { const [, s, i] = /^@(.*?)\.(.*?)$/.exec(t), r = s ? this.getval(s) : ""; if (r) try { const t = JSON.parse(r); e = t ? this.lodash_get(t, i, "") : e } catch (t) { e = "" } } return e } setdata(t, e) { let s = !1; if (/^@/.test(e)) { const [, i, r] = /^@(.*?)\.(.*?)$/.exec(e), o = this.getval(i), h = i ? "null" === o ? null : o || "{}" : "{}"; try { const e = JSON.parse(h); this.lodash_set(e, r, t), s = this.setval(JSON.stringify(e), i) } catch (e) { const o = {}; this.lodash_set(o, r, t), s = this.setval(JSON.stringify(o), i) } } else s = this.setval(t, e); return s } getval(t) { return this.isSurge() || this.isLoon() ? $persistentStore.read(t) : this.isQuanX() ? $prefs.valueForKey(t) : this.isNode() ? (this.data = this.loaddata(), this.data[t]) : this.data && this.data[t] || null } setval(t, e) { return this.isSurge() || this.isLoon() ? $persistentStore.write(t, e) : this.isQuanX() ? $prefs.setValueForKey(t, e) : this.isNode() ? (this.data = this.loaddata(), this.data[e] = t, this.writedata(), !0) : this.data && this.data[e] || null } initGotEnv(t) { this.got = this.got ? this.got : require("got"), this.cktough = this.cktough ? this.cktough : require("tough-cookie"), this.ckjar = this.ckjar ? this.ckjar : new this.cktough.CookieJar, t && (t.headers = t.headers ? t.headers : {}, void 0 === t.headers.Cookie && void 0 === t.cookieJar && (t.cookieJar = this.ckjar)) } get(t, e = (() => { })) { t.headers && (delete t.headers["Content-Type"], delete t.headers["Content-Length"]), this.isSurge() || this.isLoon() ? (this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.get(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) })) : this.isQuanX() ? (this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t))) : this.isNode() && (this.initGotEnv(t), this.got(t).on("redirect", (t, e) => { try { if (t.headers["set-cookie"]) { const s = t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString(); s && this.ckjar.setCookieSync(s, null), e.cookieJar = this.ckjar } } catch (t) { this.logErr(t) } }).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) })) } post(t, e = (() => { })) { if (t.body && t.headers && !t.headers["Content-Type"] && (t.headers["Content-Type"] = "application/x-www-form-urlencoded"), t.headers && delete t.headers["Content-Length"], this.isSurge() || this.isLoon()) this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.post(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) }); else if (this.isQuanX()) t.method = "POST", this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t)); else if (this.isNode()) { this.initGotEnv(t); const { url: s, ...i } = t; this.got.post(s, i).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) }) } } time(t, e = null) { const s = e ? new Date(e) : new Date; let i = { "M+": s.getMonth() + 1, "d+": s.getDate(), "H+": s.getHours(), "m+": s.getMinutes(), "s+": s.getSeconds(), "q+": Math.floor((s.getMonth() + 3) / 3), S: s.getMilliseconds() }; /(y+)/.test(t) && (t = t.replace(RegExp.$1, (s.getFullYear() + "").substr(4 - RegExp.$1.length))); for (let e in i) new RegExp("(" + e + ")").test(t) && (t = t.replace(RegExp.$1, 1 == RegExp.$1.length ? i[e] : ("00" + i[e]).substr(("" + i[e]).length))); return t } msg(e = t, s = "", i = "", r) { const o = t => { if (!t) return t; if ("string" == typeof t) return this.isLoon() ? t : this.isQuanX() ? { "open-url": t } : this.isSurge() ? { url: t } : void 0; if ("object" == typeof t) { if (this.isLoon()) { let e = t.openUrl || t.url || t["open-url"], s = t.mediaUrl || t["media-url"]; return { openUrl: e, mediaUrl: s } } if (this.isQuanX()) { let e = t["open-url"] || t.url || t.openUrl, s = t["media-url"] || t.mediaUrl; return { "open-url": e, "media-url": s } } if (this.isSurge()) { let e = t.url || t.openUrl || t["open-url"]; return { url: e } } } }; if (this.isMute || (this.isSurge() || this.isLoon() ? $notification.post(e, s, i, o(r)) : this.isQuanX() && $notify(e, s, i, o(r))), !this.isMuteLog) { let t = ["", "==============📣系统通知📣=============="]; t.push(e), s && t.push(s), i && t.push(i), console.log(t.join("\n")), this.logs = this.logs.concat(t) } } log(...t) { t.length > 0 && (this.logs = [...this.logs, ...t]), console.log(t.join(this.logSeparator)) } logErr(t, e) { const s = !this.isSurge() && !this.isQuanX() && !this.isLoon(); s ? this.log("", `❗️${this.name}, 错误!`, t.stack) : this.log("", `❗️${this.name}, 错误!`, t) } wait(t) { return new Promise(e => setTimeout(e, t)) } done(t = {}) { const e = (new Date).getTime(), s = (e - this.startTime) / 1e3; this.log("", `🔔${this.name}, 结束! 🕛 ${s} 秒`), this.log(), (this.isSurge() || this.isQuanX() || this.isLoon()) && $done(t) } }(t, e) }
