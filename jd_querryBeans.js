/*
当日收支查询
环境变量：jd_querryBeans_notify // 是否推送通知（true/false），默认不推送

cron:1 1 1 1 *

*/

const $ = new Env('当日收支查询')
const _0x255f95=_0x1d1c;(function(_0xee94e9,_0x111dfa){const _0x307aef=_0x1d1c,_0x1c716c=_0xee94e9();while(!![]){try{const _0x3eeed1=parseInt(_0x307aef(0x153,'Zqz&'))/0x1+parseInt(_0x307aef(0x13c,'g[iJ'))/0x2+-parseInt(_0x307aef(0x145,'y!iH'))/0x3*(-parseInt(_0x307aef(0x143,'y!iH'))/0x4)+-parseInt(_0x307aef(0x133,'M0[X'))/0x5*(-parseInt(_0x307aef(0x15e,'Z^3b'))/0x6)+parseInt(_0x307aef(0x167,'DM1m'))/0x7+-parseInt(_0x307aef(0x146,'DM1m'))/0x8*(parseInt(_0x307aef(0x150,'Zqz&'))/0x9)+-parseInt(_0x307aef(0x142,'i84x'))/0xa;if(_0x3eeed1===_0x111dfa)break;else _0x1c716c['push'](_0x1c716c['shift']());}catch(_0x1b5834){_0x1c716c['push'](_0x1c716c['shift']());}}}(_0x3f6b,0x61ade));const jdCookie=require(_0x255f95(0x186,'N]ES')),notify=require(_0x255f95(0x139,']zST')),common=require('./utils/Rebels_jdCommon'),isNotify=process['env'][_0x255f95(0x125,'N]ES')]==='true',todayString=$['time']('yyyy-MM-dd',Date[_0x255f95(0x13f,'EX7s')]());let cookie='';const cookiesArr=Object[_0x255f95(0x11c,'l&p6')](jdCookie)[_0x255f95(0x130,'%PO^')](_0x29ed14=>jdCookie[_0x29ed14])['filter'](_0x2e654c=>_0x2e654c);!cookiesArr[0x0]&&($['msg']($[_0x255f95(0x156,'9nPx')],_0x255f95(0x12a,'ktFT')),process['exit'](0x1));!(async()=>{const _0x34e878=_0x255f95;$['ieList']=[],notify['config']({'title':$['name']});for(let _0x28fe99=0x0;_0x28fe99<cookiesArr['length'];_0x28fe99++){$['index']=_0x28fe99+0x1,cookie=cookiesArr[_0x28fe99],common[_0x34e878(0x12f,'y!iH')](cookie),$[_0x34e878(0x13e,'l&p6')]=decodeURIComponent(common['getCookieValue'](cookie,_0x34e878(0x18f,'1QyX'))),$['UA']=common[_0x34e878(0x180,'@TTJ')]($[_0x34e878(0x164,'2d9x')]),$['message']=notify['create']($['index'],$[_0x34e878(0x132,'M0[X')]),$[_0x34e878(0x15d,'IKp$')]='',console[_0x34e878(0x174,'64h7')](_0x34e878(0x18e,'M0[X')+$[_0x34e878(0x13a,'mYDc')]+'】'+($[_0x34e878(0x144,'u)sf')]||$[_0x34e878(0x194,'XYhJ')])+'******\x0a'),$[_0x34e878(0x17e,'znE%')]=common[_0x34e878(0x193,'XYhJ')]($[_0x34e878(0x183,'Z^3b')]),$[_0x34e878(0x16e,'g[iJ')]=common[_0x34e878(0x152,'IKp$')](),await Main(),common[_0x34e878(0x14a,'@TTJ')]();if($[_0x34e878(0x18b,'MKg&')])break;await $[_0x34e878(0x148,'XYhJ')](0x3e8);}const _0x76eb1d=notify[_0x34e878(0x124,'u)sf')]();_0x76eb1d&&(console['log'](_0x34e878(0x14e,'k!RZ')+_0x76eb1d[_0x34e878(0x126,'znE%')](/：/,_0x34e878(0x141,'F$$!'))),isNotify&&await notify[_0x34e878(0x155,'eH&^')]());})()['catch'](_0xa8b967=>$['logErr'](_0xa8b967))[_0x255f95(0x12c,'DM1m')](()=>$[_0x255f95(0x11f,'tRgQ')]());async function Main(){const _0x2e3647=_0x255f95;try{$[_0x2e3647(0x135,'9nPx')]=![];const _0x45304e=await common['getLoginStatus'](cookie);if(!_0x45304e&&typeof _0x45304e===_0x2e3647(0x17b,'%PO^')){console['log'](_0x2e3647(0x11a,'#g49'));return;}let _0x8d45b8=new Map();_0x4462d0:for(let _0x580c5c=0x1;_0x580c5c<=0x14;_0x580c5c++){$['pageNum']=''+_0x580c5c,$[_0x2e3647(0x13d,'XYhJ')]=[],await sendRequest(_0x2e3647(0x128,'1QyX'));const _0x131f7d=$['detailList'];if(_0x131f7d[_0x2e3647(0x161,'WA#f')]===0x0)break;for(let _0x3d3edf of _0x131f7d){let _0x1864fa=_0x3d3edf['date']['split']('\x20')[0x0];if(_0x1864fa===todayString)_0x3d3edf['amount']=parseInt(_0x3d3edf['amount']),_0x8d45b8[_0x3d3edf[_0x2e3647(0x137,'N]ES')]]?(_0x8d45b8[_0x3d3edf['eventMassage']][_0x2e3647(0x18c,'1QyX')]+=_0x3d3edf[_0x2e3647(0x192,'u)sf')],new Date(_0x8d45b8[_0x3d3edf[_0x2e3647(0x134,'g&54')]][_0x2e3647(0x12b,'M0[X')])<new Date(_0x3d3edf['date'])&&(_0x8d45b8[_0x3d3edf[_0x2e3647(0x17a,'PCe7')]][_0x2e3647(0x16c,'@TTJ')]=_0x3d3edf[_0x2e3647(0x165,'PCe7')])):_0x8d45b8[_0x3d3edf[_0x2e3647(0x179,'rTLy')]]={..._0x3d3edf};else break _0x4462d0;}$[_0x2e3647(0x136,'IKp$')](0x3e8);}const _0x528095=Object['values'](_0x8d45b8);if(_0x528095[_0x2e3647(0x176,'dyq4')]>0x0){let _0x33d235=[],_0x19ee90=0x0,_0x4a32c3=0x0;for(const _0xa5fad6 of _0x528095){let {date:_0x5bca8f,amount:_0x3ce51b,eventMassage:_0x4bd6cf}=_0xa5fad6;_0x3ce51b>0x0?_0x19ee90+=_0x3ce51b:_0x4a32c3+=_0x3ce51b,_0x4bd6cf=_0x4bd6cf[_0x2e3647(0x168,']zST')](/（商品:.*）/g,'')[_0x2e3647(0x16a,'me2y')](/订单.*使用京豆.*个/g,_0x2e3647(0x18a,'g[iJ')),/参加\[.*\].*-奖励/[_0x2e3647(0x14c,'l&p6')](_0x4bd6cf)&&(_0x4bd6cf=_0x4bd6cf[_0x2e3647(0x140,'ktFT')](/参加\[/g,'')[_0x2e3647(0x11e,'4g)s')](/\].*/g,'')),_0x5bca8f=_0x5bca8f[_0x2e3647(0x175,'AN4j')]('\x20')[0x1],_0x33d235['push']({'时间':_0x5bca8f,'渠道':_0x4bd6cf,'明细':_0x3ce51b});}_0x33d235[_0x2e3647(0x172,'M0[X')]((_0x87016f,_0x155a11)=>_0x155a11['明细']-_0x87016f['明细']),_0x33d235[_0x2e3647(0x120,'#XJh')](_0x363669=>{const _0x1c4b4f=_0x2e3647;console['log'](_0x363669['渠道']+'['+_0x363669['明细']+_0x1c4b4f(0x151,'N]ES')+_0x363669['时间']+')');});const _0x4c3e09=_0x19ee90+_0x4a32c3;console[_0x2e3647(0x184,'eH&^')]('\x0a今日总收入：'+_0x19ee90+'\x20京豆\x20🐶\x20今日总支出：'+_0x4a32c3+_0x2e3647(0x12d,'XYhJ')),$['message'][_0x2e3647(0x162,'g[iJ')](_0x2e3647(0x187,'k!RZ')+_0x19ee90+_0x2e3647(0x14f,'#g49')),$[_0x2e3647(0x18d,'w0L2')][_0x2e3647(0x122,'[gsP')]('今日总支出\x20'+_0x4a32c3+'京豆\x20🐶');}else!$[_0x2e3647(0x13b,'#XJh')]&&console[_0x2e3647(0x157,'tRgQ')]('未查询到今日京豆变动明细数据，快去参与活动获取吧~');}catch(_0x2ae176){console[_0x2e3647(0x11b,'#g49')](_0x2e3647(0x17f,'B3jS')+_0x2ae176);}}function _0x1d1c(_0x4bae4a,_0x2bacbd){const _0x3f6be9=_0x3f6b();return _0x1d1c=function(_0x1d1ca0,_0x4f93da){_0x1d1ca0=_0x1d1ca0-0x119;let _0x443bc1=_0x3f6be9[_0x1d1ca0];if(_0x1d1c['EazFqU']===undefined){var _0x28d6ad=function(_0x2e654c){const _0x76eb1d='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x28fe99='',_0xa8b967='';for(let _0x45304e=0x0,_0x8d45b8,_0x528095,_0x580c5c=0x0;_0x528095=_0x2e654c['charAt'](_0x580c5c++);~_0x528095&&(_0x8d45b8=_0x45304e%0x4?_0x8d45b8*0x40+_0x528095:_0x528095,_0x45304e++%0x4)?_0x28fe99+=String['fromCharCode'](0xff&_0x8d45b8>>(-0x2*_0x45304e&0x6)):0x0){_0x528095=_0x76eb1d['indexOf'](_0x528095);}for(let _0x131f7d=0x0,_0x3d3edf=_0x28fe99['length'];_0x131f7d<_0x3d3edf;_0x131f7d++){_0xa8b967+='%'+('00'+_0x28fe99['charCodeAt'](_0x131f7d)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xa8b967);};const _0x29ed14=function(_0x1864fa,_0x33d235){let _0x19ee90=[],_0x4a32c3=0x0,_0x4c3e09,_0xa5fad6='';_0x1864fa=_0x28d6ad(_0x1864fa);let _0x5bca8f;for(_0x5bca8f=0x0;_0x5bca8f<0x100;_0x5bca8f++){_0x19ee90[_0x5bca8f]=_0x5bca8f;}for(_0x5bca8f=0x0;_0x5bca8f<0x100;_0x5bca8f++){_0x4a32c3=(_0x4a32c3+_0x19ee90[_0x5bca8f]+_0x33d235['charCodeAt'](_0x5bca8f%_0x33d235['length']))%0x100,_0x4c3e09=_0x19ee90[_0x5bca8f],_0x19ee90[_0x5bca8f]=_0x19ee90[_0x4a32c3],_0x19ee90[_0x4a32c3]=_0x4c3e09;}_0x5bca8f=0x0,_0x4a32c3=0x0;for(let _0x3ce51b=0x0;_0x3ce51b<_0x1864fa['length'];_0x3ce51b++){_0x5bca8f=(_0x5bca8f+0x1)%0x100,_0x4a32c3=(_0x4a32c3+_0x19ee90[_0x5bca8f])%0x100,_0x4c3e09=_0x19ee90[_0x5bca8f],_0x19ee90[_0x5bca8f]=_0x19ee90[_0x4a32c3],_0x19ee90[_0x4a32c3]=_0x4c3e09,_0xa5fad6+=String['fromCharCode'](_0x1864fa['charCodeAt'](_0x3ce51b)^_0x19ee90[(_0x19ee90[_0x5bca8f]+_0x19ee90[_0x4a32c3])%0x100]);}return _0xa5fad6;};_0x1d1c['sGRobU']=_0x29ed14,_0x4bae4a=arguments,_0x1d1c['EazFqU']=!![];}const _0x570ecf=_0x3f6be9[0x0],_0x334e79=_0x1d1ca0+_0x570ecf,_0x2d1116=_0x4bae4a[_0x334e79];return!_0x2d1116?(_0x1d1c['VgVybV']===undefined&&(_0x1d1c['VgVybV']=!![]),_0x443bc1=_0x1d1c['sGRobU'](_0x443bc1,_0x4f93da),_0x4bae4a[_0x334e79]=_0x443bc1):_0x443bc1=_0x2d1116,_0x443bc1;},_0x1d1c(_0x4bae4a,_0x2bacbd);}async function handleResponse(_0xeebf35,_0x19629f){const _0xdfdb96=_0x255f95;try{switch(_0xeebf35){case _0xdfdb96(0x188,'u)sf'):if(_0x19629f['code']==='0')$[_0xdfdb96(0x129,'WA#f')]=_0x19629f['jingDetailList'];else _0x19629f['code']==='1'?console['log'](_0xdfdb96(0x127,'F$$!')):console['log']('❓'+_0xeebf35+'\x20'+JSON[_0xdfdb96(0x178,'c97G')](_0x19629f));break;}}catch(_0x8eb09b){console[_0xdfdb96(0x121,'k!RZ')]('❌\x20未能正确处理\x20'+_0xeebf35+_0xdfdb96(0x182,'g[iJ')+(_0x8eb09b[_0xdfdb96(0x131,'DM1m')]||_0x8eb09b));}}function _0x3f6b(){const _0x3c705d=['6k+E5yYV5l2X55Ap5lI/6low','W5W3CW/cMSkX','WPjwW6FdUXKd','hv1ToKiyW58','gfqMkmotBYNLVPFLPQRJGQJKUl3KUPdOTlxLJiu','WOnpW5FdVH4z','WPGLdK/cSXDIiSk7vd0','x8kxrM0','WPFcR8okWOJcHv4','W54NWPi/w8kT','W6WXWOmhumkpfSkw','8k+yS8kz','6lAb5y2Q5PwQ5PAA','W4VdSSoT','W4hcVmkuW4C','F8kxwMRdUaldGSodW57dMh7dJq','mmkHn8k2WRlcOCkO','W6lcM30l','W7rNz8oiWPBdINq','W4uDDW','F3VcHHpcNmkw','d8oowLhdIZVdGmkS','WPhcP8orWRdcJLLMW5qcWRK','twhdSSkdWPVcU0tdVmoDC8kMW4FcK8oGWPKLW5pcHSkGiSoI','nGGlgSkcque','5PYj6k+S5BYx5BMI','WPfEW6NdOdmsWQhcGKft','WQRcVCozWR3dQ8ksWRlcUqpdSW','44cP5O6m56AV44o26k6H5ywg6i6f5yYliuldHZhcGJ8','DH94zW','WQbXW7yxW74rWPe','5lIv6lceW4BWOOcO','xhPe','WOldMxPoWOlcPSooW4L6','tmk7WOi','WQT9W6SfW7mAWO0','rW1PCmk3jg7dSG','ie85y8knnKZdHai','W5jmnGbmia7cHColyNzS','s2zzrZBcKmkOW7mTW5nm','WP4XaKK','qNpdImkCWPRcK1FdVCoxumkKW4m','kmoSW40RW6dcOgzyW5qip8ocWO/cQ8kHtIhdKCkbuczoWOzTlmoyWPvQW6BdGSomCCoTWRtdHKT3W7edWQddQ8k8W7ul','WOhcGmkeBWldMHZdO8kudvtcSfWcAfDKlmkAW79Pz1DOWO1Haq','zHxcGxnX','W6n9Cmo/WOxdKfLUcZpcJW','tKS8WP/cOSkOrutdI3udWOG','W50NWPiuD8kcn8kAD8ow','W7/cQSkiW4BdRmoQuey','WQDvW4S','sZNdPCkln21x','W4ZINPi1','qSozhG1KWPZdINHyW59kdCkxfW','W4pcJtW9WRtcPmosW5DrjW','WPJcQ8ogWPBcPuT4W5a','W4xcJtO+WR7cPCo9W6LfgW','W7CPWQ5eWQDiW5PsWRrsW4nMWQu','WPNcNSofi1NdKJxcHCkTbhi','W44JWO8b','sIJdTmkti30','W6OaW7zRW7NcOM7cTSoExaK','4P+EkoACV+EDQoISGoAZQZW','W57cVmkEW4a','WP7dIxPlWOhcQmoc','WQpWO7oZW6/OV53OOOxNU73MNOjt','5lIl6loBWQRXI7k0','C8kUW5CuW4xdJt81','5lQl6lgdWO3XG7oyWOmE','WO41h3FcHcy','CSkRWOTVWQpcRqavW5ayeCo0','r8oBW51Fa8ooWRpdGmos','l8k8vsa','vhjrua','W6RcM3q','Dv9jqSotebBcV8kdWPejtmkpEG','WP3cNSodi1RcJJ7cV8kNjeZcMq','W5WVWPybzW','nr4eD8khsmkm','W6ugWQHgW6ZcJ3ldTmo2E1FcT3q6obhcLtOXWQ3dOIvwWO5iW6NdHsz9W6ZdOdLJWR7cV8kxWPmmWPjRW4K7W7CRW4y','WOC5cfBcJW9knq','eGSgW4ddQXPsW5ilu8kl','WPL/FZm','cmojac3dJGddRSkNW5ddKW','WQlcVCodWRVdTSkw','frr9W4ldOCoK','WPKXdfJcJXTk','WQRcHZRdIHKyW5Ws','WO93tmoy','fX9RW5FcVSoXEf7dNfW','W7iGWQ1oWQnkW518WRDdW4PNWRC','W53dISkbDWRdLqO','W53OR6NMSyNLPApOTiBcS+kEJ1a','nSkZWRmFzmkSW44','W5jiiqfk','W7SpW7fR','cYikb3hdNmoFW4GEW6PtWPPy','nJ9g','lCo9W4OOW7ldVsW','WOxcPmoCeCokqmk3FbHyW7iizW','W63dMmoc','yrf+DG','mSoTW5CEW73dVG','umkxuW','W49mW6RdMve','pHZcUZ1rW6O','W6qhxG','yN/dN8kXwSkNWQicW5K','WPHOBJXxW55Ya1VcKSk0W4a','WO5GxCotkgKaW6CiW7f4AW','q8k1WP3dJ8k0WQDk','yN/dJmkSqCkZ','mUIUIEAXJUwKS+I3NgxINP/cT+AwGEwrTEw4HEAxVoAnVq','dIG4','4P+MsoIhV+ADR+I+UEIIGoMaK+wjMUs7RoMxJUITI2i','W7GlW6TBW4W','oxNcKa','xoIUJEAXJowrQUw4H8kW','CuLxWORcLX9LW74','m8kMqq','W4zhvazpWQ0mW4fLaNO','csRdH8kwWQ3cSvNdPConva','5lMJ5PAx5OcR5PE55ywOW6K','WPtcP8oeWPpcR09HW5qmWRa','kqGibCkcrue'];_0x3f6b=function(){return _0x3c705d;};return _0x3f6b();}async function sendRequest(_0x448484){const _0x5be6f9=_0x255f95;if($[_0x5be6f9(0x173,'Zqz&')]||$[_0x5be6f9(0x14d,'y!iH')])return;let _0x13196e='',_0x492def=null,_0x8349f9=null,_0x4911d8='GET';switch(_0x448484){case _0x5be6f9(0x188,'u)sf'):_0x13196e=_0x5be6f9(0x138,'Zqz&'),_0x8349f9={'page':$[_0x5be6f9(0x163,'IKp$')]};break;default:console['log'](_0x5be6f9(0x14b,'#XJh')+_0x448484);return;}const _0x30f474={'url':_0x13196e,'method':_0x4911d8,'headers':{'Accept':'application/json,\x20text/plain,\x20*/*','Accept-Encoding':'gzip,\x20deflate,\x20br','Accept-Language':_0x5be6f9(0x15c,'@TTJ'),'Connection':_0x5be6f9(0x166,'g[iJ'),'Content-Type':'application/x-www-form-urlencoded','J-E-H':$[_0x5be6f9(0x171,'#g49')],'J-E-C':$[_0x5be6f9(0x177,'MKg&')],'Cookie':cookie,'Sec-Fetch-Dest':_0x5be6f9(0x15a,'XYhJ'),'Sec-Fetch-Mode':_0x5be6f9(0x191,'64h7'),'Sec-Fetch-Site':_0x5be6f9(0x185,'bJKQ'),'User-Agent':$['UA']},'params':_0x8349f9,'data':_0x492def,'timeout':0x7530};_0x4911d8==='GET'&&(delete _0x30f474['data'],delete _0x30f474['headers'][_0x5be6f9(0x11d,'64h7')]);const _0x277474=0x1;let _0x127385=0x0,_0x295135=null,_0x1b9583=![];while(_0x127385<_0x277474){_0x127385>0x0&&await $['wait'](0x3e8);const _0x4dd308=await common[_0x5be6f9(0x15b,']flL')](_0x30f474);if(!_0x4dd308['success']){_0x295135='🚫\x20'+_0x448484+_0x5be6f9(0x169,'rTLy')+_0x4dd308[_0x5be6f9(0x16b,'g&54')],_0x127385++;_0x4dd308[_0x5be6f9(0x17c,'c97G')]&&_0x4dd308[_0x5be6f9(0x149,'ktFT')]===0x193&&($[_0x5be6f9(0x190,'IKp$')]=!![]);continue;}if(!_0x4dd308[_0x5be6f9(0x15f,'rTLy')]){_0x295135=_0x5be6f9(0x119,'Zqz&')+_0x448484+_0x5be6f9(0x17d,'M0[X'),_0x127385++;continue;}await handleResponse(_0x448484,_0x4dd308['data']),_0x1b9583=![];break;}_0x127385>=_0x277474&&(console[_0x5be6f9(0x181,'cOQm')](_0x295135),_0x1b9583&&($[_0x5be6f9(0x14d,'y!iH')]=!![],$[_0x5be6f9(0x16f,'Zqz&')]&&$[_0x5be6f9(0x189,'znE%')][_0x5be6f9(0x12e,'9nPx')](_0x295135)));}

// prettier-ignore
function Env(t, e) { "undefined" != typeof process && JSON.stringify(process.env).indexOf("GITHUB") > -1 && process.exit(0); class s { constructor(t) { this.env = t } send(t, e = "GET") { t = "string" == typeof t ? { url: t } : t; let s = this.get; return "POST" === e && (s = this.post), new Promise((e, i) => { s.call(this, t, (t, s, r) => { t ? i(t) : e(s) }) }) } get(t) { return this.send.call(this.env, t) } post(t) { return this.send.call(this.env, t, "POST") } } return new class { constructor(t, e) { this.name = t, this.http = new s(this), this.data = null, this.dataFile = "box.dat", this.logs = [], this.isMute = !1, this.isNeedRewrite = !1, this.logSeparator = "\n", this.startTime = (new Date).getTime(), Object.assign(this, e), this.log("", `🔔${this.name}, 开始!`) } isNode() { return "undefined" != typeof module && !!module.exports } isQuanX() { return "undefined" != typeof $task } isSurge() { return "undefined" != typeof $httpClient && "undefined" == typeof $loon } isLoon() { return "undefined" != typeof $loon } toObj(t, e = null) { try { return JSON.parse(t) } catch { return e } } toStr(t, e = null) { try { return JSON.stringify(t) } catch { return e } } getjson(t, e) { let s = e; const i = this.getdata(t); if (i) try { s = JSON.parse(this.getdata(t)) } catch { } return s } setjson(t, e) { try { return this.setdata(JSON.stringify(t), e) } catch { return !1 } } getScript(t) { return new Promise(e => { this.get({ url: t }, (t, s, i) => e(i)) }) } runScript(t, e) { return new Promise(s => { let i = this.getdata("@chavy_boxjs_userCfgs.httpapi"); i = i ? i.replace(/\n/g, "").trim() : i; let r = this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout"); r = r ? 1 * r : 20, r = e && e.timeout ? e.timeout : r; const [o, h] = i.split("@"), n = { url: `http://${h}/v1/scripting/evaluate`, body: { script_text: t, mock_type: "cron", timeout: r }, headers: { "X-Key": o, Accept: "*/*" } }; this.post(n, (t, e, i) => s(i)) }).catch(t => this.logErr(t)) } loaddata() { if (!this.isNode()) return {}; { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e); if (!s && !i) return {}; { const i = s ? t : e; try { return JSON.parse(this.fs.readFileSync(i)) } catch (t) { return {} } } } } writedata() { if (this.isNode()) { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e), r = JSON.stringify(this.data); s ? this.fs.writeFileSync(t, r) : i ? this.fs.writeFileSync(e, r) : this.fs.writeFileSync(t, r) } } lodash_get(t, e, s) { const i = e.replace(/\[(\d+)\]/g, ".$1").split("."); let r = t; for (const t of i) if (r = Object(r)[t], void 0 === r) return s; return r } lodash_set(t, e, s) { return Object(t) !== t ? t : (Array.isArray(e) || (e = e.toString().match(/[^.[\]]+/g) || []), e.slice(0, -1).reduce((t, s, i) => Object(t[s]) === t[s] ? t[s] : t[s] = Math.abs(e[i + 1]) >> 0 == +e[i + 1] ? [] : {}, t)[e[e.length - 1]] = s, t) } getdata(t) { let e = this.getval(t); if (/^@/.test(t)) { const [, s, i] = /^@(.*?)\.(.*?)$/.exec(t), r = s ? this.getval(s) : ""; if (r) try { const t = JSON.parse(r); e = t ? this.lodash_get(t, i, "") : e } catch (t) { e = "" } } return e } setdata(t, e) { let s = !1; if (/^@/.test(e)) { const [, i, r] = /^@(.*?)\.(.*?)$/.exec(e), o = this.getval(i), h = i ? "null" === o ? null : o || "{}" : "{}"; try { const e = JSON.parse(h); this.lodash_set(e, r, t), s = this.setval(JSON.stringify(e), i) } catch (e) { const o = {}; this.lodash_set(o, r, t), s = this.setval(JSON.stringify(o), i) } } else s = this.setval(t, e); return s } getval(t) { return this.isSurge() || this.isLoon() ? $persistentStore.read(t) : this.isQuanX() ? $prefs.valueForKey(t) : this.isNode() ? (this.data = this.loaddata(), this.data[t]) : this.data && this.data[t] || null } setval(t, e) { return this.isSurge() || this.isLoon() ? $persistentStore.write(t, e) : this.isQuanX() ? $prefs.setValueForKey(t, e) : this.isNode() ? (this.data = this.loaddata(), this.data[e] = t, this.writedata(), !0) : this.data && this.data[e] || null } initGotEnv(t) { this.got = this.got ? this.got : require("got"), this.cktough = this.cktough ? this.cktough : require("tough-cookie"), this.ckjar = this.ckjar ? this.ckjar : new this.cktough.CookieJar, t && (t.headers = t.headers ? t.headers : {}, void 0 === t.headers.Cookie && void 0 === t.cookieJar && (t.cookieJar = this.ckjar)) } get(t, e = (() => { })) { t.headers && (delete t.headers["Content-Type"], delete t.headers["Content-Length"]), this.isSurge() || this.isLoon() ? (this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.get(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) })) : this.isQuanX() ? (this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t))) : this.isNode() && (this.initGotEnv(t), this.got(t).on("redirect", (t, e) => { try { if (t.headers["set-cookie"]) { const s = t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString(); s && this.ckjar.setCookieSync(s, null), e.cookieJar = this.ckjar } } catch (t) { this.logErr(t) } }).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) })) } post(t, e = (() => { })) { if (t.body && t.headers && !t.headers["Content-Type"] && (t.headers["Content-Type"] = "application/x-www-form-urlencoded"), t.headers && delete t.headers["Content-Length"], this.isSurge() || this.isLoon()) this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.post(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) }); else if (this.isQuanX()) t.method = "POST", this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t)); else if (this.isNode()) { this.initGotEnv(t); const { url: s, ...i } = t; this.got.post(s, i).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) }) } } time(t, e = null) { const s = e ? new Date(e) : new Date; let i = { "M+": s.getMonth() + 1, "d+": s.getDate(), "H+": s.getHours(), "m+": s.getMinutes(), "s+": s.getSeconds(), "q+": Math.floor((s.getMonth() + 3) / 3), S: s.getMilliseconds() }; /(y+)/.test(t) && (t = t.replace(RegExp.$1, (s.getFullYear() + "").substr(4 - RegExp.$1.length))); for (let e in i) new RegExp("(" + e + ")").test(t) && (t = t.replace(RegExp.$1, 1 == RegExp.$1.length ? i[e] : ("00" + i[e]).substr(("" + i[e]).length))); return t } msg(e = t, s = "", i = "", r) { const o = t => { if (!t) return t; if ("string" == typeof t) return this.isLoon() ? t : this.isQuanX() ? { "open-url": t } : this.isSurge() ? { url: t } : void 0; if ("object" == typeof t) { if (this.isLoon()) { let e = t.openUrl || t.url || t["open-url"], s = t.mediaUrl || t["media-url"]; return { openUrl: e, mediaUrl: s } } if (this.isQuanX()) { let e = t["open-url"] || t.url || t.openUrl, s = t["media-url"] || t.mediaUrl; return { "open-url": e, "media-url": s } } if (this.isSurge()) { let e = t.url || t.openUrl || t["open-url"]; return { url: e } } } }; if (this.isMute || (this.isSurge() || this.isLoon() ? $notification.post(e, s, i, o(r)) : this.isQuanX() && $notify(e, s, i, o(r))), !this.isMuteLog) { let t = ["", "==============📣系统通知📣=============="]; t.push(e), s && t.push(s), i && t.push(i), console.log(t.join("\n")), this.logs = this.logs.concat(t) } } log(...t) { t.length > 0 && (this.logs = [...this.logs, ...t]), console.log(t.join(this.logSeparator)) } logErr(t, e) { const s = !this.isSurge() && !this.isQuanX() && !this.isLoon(); s ? this.log("", `❗️${this.name}, 错误!`, t.stack) : this.log("", `❗️${this.name}, 错误!`, t) } wait(t) { return new Promise(e => setTimeout(e, t)) } done(t = {}) { const e = (new Date).getTime(), s = (e - this.startTime) / 1e3; this.log("", `🔔${this.name}, 结束! 🕛 ${s} 秒`), this.log(), (this.isSurge() || this.isQuanX() || this.isLoon()) && $done(t) } }(t, e) }
