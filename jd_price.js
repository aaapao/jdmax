/*
活动名称：一键价保
环境变量：jd_price_interval // 自定义运行间隔时长（整数，单位毫秒），默认1500
        jd_price_notify // 是否推送通知（true/false），默认不推送
        jd_price_pinFilter // 账号pin过滤，多个用@进行分割

cron:55 12 * * *

*/

const $ = new Env('一键价保')
const _0x22c0f3=_0x1208;(function(_0x280f9a,_0x579435){const _0x3ca32b=_0x1208,_0x2d950c=_0x280f9a();while(!![]){try{const _0xd996a5=parseInt(_0x3ca32b(0x108,'e3M8'))/0x1+-parseInt(_0x3ca32b(0x16a,'nGxG'))/0x2*(-parseInt(_0x3ca32b(0x141,'zT7%'))/0x3)+parseInt(_0x3ca32b(0xf6,'YfzK'))/0x4+parseInt(_0x3ca32b(0x120,'S7V['))/0x5+parseInt(_0x3ca32b(0x128,'Rdb#'))/0x6+-parseInt(_0x3ca32b(0x163,'wTLV'))/0x7+-parseInt(_0x3ca32b(0x18a,'8PV6'))/0x8;if(_0xd996a5===_0x579435)break;else _0x2d950c['push'](_0x2d950c['shift']());}catch(_0x183ee2){_0x2d950c['push'](_0x2d950c['shift']());}}}(_0x3de2,0xa2c01));const jdCookie=require(_0x22c0f3(0x173,'t)JJ')),notify=require(_0x22c0f3(0x148,'n#Cl')),common=require(_0x22c0f3(0x181,'bMwu')),{H5st}=require(_0x22c0f3(0x161,'VQaX'));let taskThreads=process[_0x22c0f3(0x12b,'VQaX')][_0x22c0f3(0x124,'h*B(')]||'1';function _0x1208(_0x1dfc3b,_0x1cab02){const _0x3de21f=_0x3de2();return _0x1208=function(_0x120872,_0x1eebb6){_0x120872=_0x120872-0xf6;let _0x41fdba=_0x3de21f[_0x120872];if(_0x1208['nRGcxc']===undefined){var _0x4c5029=function(_0x2fa03f){const _0xe49346='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x23bcd0='',_0x4bd09e='';for(let _0x586689=0x0,_0x4e9fd0,_0x215385,_0x63bf2f=0x0;_0x215385=_0x2fa03f['charAt'](_0x63bf2f++);~_0x215385&&(_0x4e9fd0=_0x586689%0x4?_0x4e9fd0*0x40+_0x215385:_0x215385,_0x586689++%0x4)?_0x23bcd0+=String['fromCharCode'](0xff&_0x4e9fd0>>(-0x2*_0x586689&0x6)):0x0){_0x215385=_0xe49346['indexOf'](_0x215385);}for(let _0x5ad416=0x0,_0x43d628=_0x23bcd0['length'];_0x5ad416<_0x43d628;_0x5ad416++){_0x4bd09e+='%'+('00'+_0x23bcd0['charCodeAt'](_0x5ad416)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4bd09e);};const _0xe31f3a=function(_0x115ab0,_0x1ed5e){let _0x331373=[],_0x140924=0x0,_0x3a9a0e,_0x5c5453='';_0x115ab0=_0x4c5029(_0x115ab0);let _0x3f8516;for(_0x3f8516=0x0;_0x3f8516<0x100;_0x3f8516++){_0x331373[_0x3f8516]=_0x3f8516;}for(_0x3f8516=0x0;_0x3f8516<0x100;_0x3f8516++){_0x140924=(_0x140924+_0x331373[_0x3f8516]+_0x1ed5e['charCodeAt'](_0x3f8516%_0x1ed5e['length']))%0x100,_0x3a9a0e=_0x331373[_0x3f8516],_0x331373[_0x3f8516]=_0x331373[_0x140924],_0x331373[_0x140924]=_0x3a9a0e;}_0x3f8516=0x0,_0x140924=0x0;for(let _0x3ea189=0x0;_0x3ea189<_0x115ab0['length'];_0x3ea189++){_0x3f8516=(_0x3f8516+0x1)%0x100,_0x140924=(_0x140924+_0x331373[_0x3f8516])%0x100,_0x3a9a0e=_0x331373[_0x3f8516],_0x331373[_0x3f8516]=_0x331373[_0x140924],_0x331373[_0x140924]=_0x3a9a0e,_0x5c5453+=String['fromCharCode'](_0x115ab0['charCodeAt'](_0x3ea189)^_0x331373[(_0x331373[_0x3f8516]+_0x331373[_0x140924])%0x100]);}return _0x5c5453;};_0x1208['jHfzIB']=_0xe31f3a,_0x1dfc3b=arguments,_0x1208['nRGcxc']=!![];}const _0x401137=_0x3de21f[0x0],_0xc347cf=_0x120872+_0x401137,_0x2e77bf=_0x1dfc3b[_0xc347cf];return!_0x2e77bf?(_0x1208['MpwlFI']===undefined&&(_0x1208['MpwlFI']=!![]),_0x41fdba=_0x1208['jHfzIB'](_0x41fdba,_0x1eebb6),_0x1dfc3b[_0xc347cf]=_0x41fdba):_0x41fdba=_0x2e77bf,_0x41fdba;},_0x1208(_0x1dfc3b,_0x1cab02);}const runInterval=process[_0x22c0f3(0x103,'KXr*')][_0x22c0f3(0xf9,'M[!o')]||_0x22c0f3(0xf7,'4qzN'),isNotify=(process['env'][_0x22c0f3(0x14d,'v(9F')]||process[_0x22c0f3(0x103,'KXr*')][_0x22c0f3(0xfd,'bMwu')])===_0x22c0f3(0x13e,'VQaX'),pinFilter=(process[_0x22c0f3(0x14c,'@@rR')][_0x22c0f3(0x156,'Rdb#')]||'')[_0x22c0f3(0x105,'DofD')]('@'),maxThreads=0x1;let cookiesArr=Object[_0x22c0f3(0x184,'KXr*')](jdCookie)[_0x22c0f3(0x12d,'bMwu')](_0xe31f3a=>jdCookie[_0xe31f3a])[_0x22c0f3(0x178,'PKS#')](_0x2fa03f=>_0x2fa03f);!cookiesArr[0x0]&&($[_0x22c0f3(0x10f,'v(9F')]($[_0x22c0f3(0x180,'ZI5X')],_0x22c0f3(0x16c,'X1zY')),process[_0x22c0f3(0x16e,'4qzN')](0x1));function _0x3de2(){const _0x4bc13d=['WOLpdItdMWdcIXX4WPRcHSkQ','whSXuCoE','d8kaq8kQWOyngwe','kLCX','q8ofD8kvW6S/W7u9hdxcMmoiAWHqW54BtSkAsmk4WQfHbSkWiqa','w8okdfdcSsKLW55eCSk2WRxdPCk5','W4CcWPe','WP/dHra3bYBcRbWnkSkHCq3dNcJcGJRdV3NcMZ0','dSo+W7XZ','W5hdVa3dGrOO','WPldJXe2','WPH+WPtcHHVdJ1WDumkBBmkkWRe5uNxdRJddKSoyWQlcPqhdH3FcNW','WOKldXldSmk6WPqJzftdMWLb','cmklrCkIWQemex1tW5GDaCkrW5DDWPhcUub1W7/dRq','EZ3dP8o1WQ9b','wmkFW7TV','5y+p6yAD54I25OkX57Io5P2SW5ecrd7cOCkDWPFdKmkPya','WOpORjVMS5lLKy7LU5yJ','FtBdQ8onWRjs','W5yxwG','W5jwsvFcQSo7W5ChtxRdSYPJW6PHF8osweldRCoHW6ezjaJdKtO','W4xdK8oCsG','yYZdOG','WQappu3dM8ofWRtcHmk9WOZdUCo8WOO','n+IUPEAZGUwMGEI3UbpINBaF5PAz5zoo5BIi5PEq5O+e','fhfo','h3Lo','e8oPW6ldJ8ooW6nGW6WCc8khhw3dRmkoWR4','vSoqtSki','WPK4W5axWQ9n','5l2+5lIB55AJ6k205AwZ6lsMseq','zsRcHmosWOrMCCkyW7FdLmorW5/dOq','Bmo9W6CMuqtdUCkWlmkl','pxFdKa','DmoUkq','zUkEPhy','WPVdM2m','k8knpW','uSokhwtcKsmWW4HHy8kuWQ7dV8kHluupW5nBW6KM','5lUyWOuN5yAw5l2z5lQ4WR10','FCk3ymkg','tCkFW7nRW5i','cIXOnSoBW7xcJaRcNmoU','w38Rzq','AYldSCoP','EZ3dPW','DpcNSzFcR+I/NEIGKoE5LEADGCo+','WPH+WPtcHHVdJ1WDumkBBmkkWRe5uNxdRJddKSoyWQlcPqhdH3C','4P+8W5FMN7ZNN53OR5dMSlqZ','WRpdHaeF','WPXVWO7cKrZcNq','5y6j6yEx5B635zol54Ia5OgwESoCWOlcNCkhWQJcV8o8BSk7','nCkhkmkLh0jP','zCoYkSkY','BNncgYxcQq','W7SsW6O','o1LAiYRcJLC','DmoQC8kzDaK','w8kbW6HNW4u','WPGDcYRdKflcISo5cv8','56A4WPdOV6pOO63PLzdPMORMLilPLyG','z8o9W70mqb8','WPSMW54','v8kWW6bZweXaW7JdHM56vSkqeK3cTgZdPCkhqsddHSkkW63dSCoUCG','b8kEumkQWPOkhwzmW5iWqCkuW49BWPRdNa5LW7/dRw4dW5SjbK/dGqRdPry4qW','W5tdQaRdScaLW5ddOq','nxNdG8kf','W5PutW','W4avWQK5m8ooWQNcP0JcPKVcKI8ldW','gGpdGmoU','WQunpu3dN8odWRlcM8kXWP7dMSoEWRO','5lUC55cy5B2F5yw3WQxcR8k5','ySo2W6aorGm','W4RcGSoZW683zXCx','W7ZcOXpcV8kOgaBdJ3Ov','eWVdMG','gKJdJrv2W5vkW48uW5tdJNOCWOVcLbOFDsC1mW','o3ZdQmkuW4q+jmkeW6ddKmotW7VdHmkOp8oYteW','W5hdRbldSre/W4K','Dd3dRSotWOLsWP9u','z8kvemoidhecfZirW5eg','5P6y5Q2b5OI+5yUC5l6z5lM5','6zEE6zMy5Psx6zA9W5NcJXy','5Bwe6k+y572B6lEW6l6d6l2u6kc55B6T5yUt6lAN5yYf','4P+8W5FOH4ZMNjtOV7FOOlRPGztLIBBKUilPLPpORPJdMG','W5tcLSkIwq','8lcQKrK','gMXcW4ZdTclcQKzzx3NcGNtdO8oUW7xdGCkbW5Wopa','p8kVkSkJW5VdOCoWfCkHAt/dGCkFCSk0yW','8jc5Mmk6','W456WPvjW70sWPD9E8klWPnKW4q','osFdOa','w8okdeZcRce0W4LeCSk2WRxdPCk5','CmoMga','aSkpvmkN','WOuSW4PZW4FcHrxcJJShoSo8WRzTmG','W4GDtxlcJ0C','rYObWO7dG2ldQWbYra','6yk7552z5OYA6ycUsYv7','44kX5O2S56Ai44c+6k6g5ywn6i6x5yY9aCo2fxXYuW','W5qDwhpcVfBcJanbWOxcR8kFDmoIWRRcMCoujvZcQgi','WRJdNquo','b8kEumkQWPy','W5BdNCoBwYvStCko','gSk5BmorW41W','W4/dNCoFsG','AbC8B8oHa8kDW5tcSXa','rmkTWOZcPW','DSkcbSozf3O','iM3dLmkhW5mKna','BNnw','WPFdIrKNmde','W5fvtG','dCkAstJdU3jLW71HFmkuWRddKq','5lMvWQvd5yE15l6P5lQ7WOFcPa','WPdcJmkbguCYemknbSo/mN9i','W5ZcMmkX','wmkAW7rPW5T3W7W','5PYs5Q+s5OQk5yQx5l2Q5lUS','gKZdHrq','W5JcLwBcGCk6hSkGWOFdUCkEvmkopCoEimobm3ZcT8o/c0PM','rSkBWOqJWP5lWOZdQ03cRsH3WRqk','W7mCW7NcPq','WPWSW4bW','z8o3W7q','W4qvxsS','WPXLWOC','WPSSW5DKW5ZcGW','k10LEmodc8kx','xCkVW73dRwlcUSk9B1BdQ1VcPmoq','dILMnSkOWRFdKGlcLCoeWRSGwq','W6/cLvXk','4PIkuEIeNowVK+s4IoI9T+IIHUMuTUMAG+AuVUMvM+ITMoE8QoMvToIUMq','rmonwmkxW7yMW6qXidNcQCopzq9PW5eu','k8khnSkUcKK','5P+X6l2X6lwy5lIJ5zst5zkc5PsH5BAD5lQm772d5Psc6zYE5l6/5lMa','WRhdIGS','WPZdNKZcHCkHg8kWW43dTmk1wCkFomolbG','h8o2WQxcTJ8','WQ7cRCoCvmojtmooamkWW7SMqsjEfCop','W4pcG8kKuuKrEIddVq','44gP6lAR5y2k','rSkCwmowWQP/WQLK','WPiNW48','DSoQBSk0','tCkdW7zHW4m','WPqKW4q','ugSRqSoZW67cHq','WOpdGmoLcXjfEtBdI8oWhCkk'];_0x3de2=function(){return _0x4bc13d;};return _0x3de2();}!(async()=>{const _0x40fba8=_0x22c0f3;notify['config']({'title':$[_0x40fba8(0x174,'wPqC')]}),await Main(),isNotify&&notify[_0x40fba8(0x144,'tV4C')]()&&await notify[_0x40fba8(0x131,'voNa')]();})()['catch'](_0xe49346=>$[_0x22c0f3(0x117,'YjVf')](_0xe49346))[_0x22c0f3(0x17e,'DofD')](()=>$[_0x22c0f3(0x11e,'X1zY')]());async function Main(){const _0x387fd0=_0x22c0f3;try{try{const _0x4bd09e=parseInt(taskThreads);_0x4bd09e>0x0&&_0x4bd09e!==0x1&&(taskThreads=_0x4bd09e);}catch{taskThreads=0x1;}taskThreads=Math[_0x387fd0(0x154,'nS6x')](taskThreads,maxThreads),$[_0x387fd0(0x170,'X1zY')]=null;if(runInterval)try{const _0x586689=parseInt(runInterval);_0x586689>=0x0&&($['waitTime']=_0x586689);}catch{console[_0x387fd0(0xfc,'4qzN')](_0x387fd0(0xf8,'v(9F'));}console[_0x387fd0(0x187,'wL^7')](_0x387fd0(0x153,'awDi')+$[_0x387fd0(0x172,'X1zY')]+_0x387fd0(0x13c,'Rdb#')),console[_0x387fd0(0x12e,'Yx3M')](_0x387fd0(0x15b,'wPqC')+$[_0x387fd0(0x14a,'Xfox')]/0x3e8+_0x387fd0(0x145,'@Tuy')),console[_0x387fd0(0x11c,'g9F5')](_0x387fd0(0x150,'YfzK')+common[_0x387fd0(0x10e,'eQml')]()+']'),console[_0x387fd0(0x166,'zHAh')](_0x387fd0(0x16b,'X1zY')+(isNotify?'开启':'关闭')+']'),console[_0x387fd0(0x106,'wTLV')]('账号过滤:\x20['+pinFilter['join'](',\x20')+']'),console['log']('=========='+$[_0x387fd0(0x13a,'4qzN')]+_0x387fd0(0x119,'YjVf')),console[_0x387fd0(0x106,'wTLV')](''),$[_0x387fd0(0x110,'PKS#')]=[],await common[_0x387fd0(0x158,'YjVf')](taskThreads,cookiesArr,taskFnc),$['hasPrintActInfo']=![],$[_0x387fd0(0x11b,'gE0g')]=![];$[_0x387fd0(0x16d,'g9F5')][_0x387fd0(0x146,'Tq8o')]>0x0&&(cookiesArr=cookiesArr[_0x387fd0(0x13f,'zT7%')]((_0x4e9fd0,_0x215385)=>!$[_0x387fd0(0x116,'%oTV')]['includes'](_0x215385+0x1)),$['needRemoveCookieIndex']=[]);const _0x23bcd0=notify[_0x387fd0(0x129,'Tq8o')]();_0x23bcd0&&console[_0x387fd0(0x17d,'e3M8')](_0x387fd0(0x137,'nS6x')+_0x23bcd0[_0x387fd0(0x13d,'Yx3M')](/：/g,_0x387fd0(0x12c,'t)JJ')));}catch(_0x63bf2f){console[_0x387fd0(0x136,'YjVf')](_0x387fd0(0x15d,'e3M8')+_0x63bf2f);}}async function taskFnc(_0x5ad416,_0x43d628){const _0x17620e=_0x22c0f3;if($[_0x17620e(0x112,'Xfox')])return{'runEnd':!![]};const _0x115ab0=decodeURIComponent(common[_0x17620e(0x182,'f$A1')](_0x5ad416,_0x17620e(0x171,'@Tuy')));function _0x1ed5e(_0xb0c82b,_0x4877d1){const _0x52a39c=_0x17620e;if(_0xb0c82b['length']<=0x4)return _0xb0c82b;else{const _0x49bacc=_0xb0c82b[_0x52a39c(0x132,'DofD')](0x0,0x2),_0xd7b60a=_0xb0c82b[_0x52a39c(0xfe,'8PV6')](-0x2),_0x332ae6=Math[_0x52a39c(0x123,'nGxG')](_0x4877d1-_0x49bacc[_0x52a39c(0xfa,'Yx3M')]-_0xd7b60a[_0x52a39c(0x188,'KXr*')],0x0),_0x13c4dc='*'[_0x52a39c(0x169,'g9F5')](_0x332ae6);return _0x49bacc+_0x13c4dc+_0xd7b60a;}}const _0x331373=decodeURIComponent(_0x115ab0),_0x140924=_0x1ed5e(_0x331373,0x6),_0x3a9a0e=_0x17620e(0x101,'h*B(')+_0x43d628+'】'+_0x140924+'：',_0x5c5453=notify[_0x17620e(0x175,'dxPE')](_0x43d628,_0x115ab0);if(pinFilter[_0x17620e(0x13b,'wL^7')]>0x0&&(pinFilter[_0x17620e(0x152,'w!CI')](_0x115ab0)||pinFilter[_0x17620e(0x10b,'%oTV')](encodeURIComponent(_0x115ab0)))){_0x5c5453[_0x17620e(0x122,'nGxG')](_0x17620e(0x15c,'Y3xZ')),console['log'](_0x5c5453[_0x17620e(0xff,'qiAq')]()),$[_0x17620e(0x12f,'eQml')][_0x17620e(0x104,'YV3]')](_0x43d628);return;}const _0x3f8516=await common[_0x17620e(0x165,'eQml')](_0x5ad416);if(!_0x3f8516&&typeof _0x3f8516==='boolean'){console[_0x17620e(0x10c,'t)JJ')](_0x3a9a0e+'账号无效'),_0x5c5453[_0x17620e(0x177,'zT7%')]('账号无效'),$[_0x17620e(0x155,'ZI5X')][_0x17620e(0x186,'pMJ[')](_0x43d628);return;}const _0x3ea189=common[_0x17620e(0x10a,'YfzK')](_0x115ab0);await _0x2a1cdb(_0x17620e(0x11d,'@@rR'));if($['runEnd'])return{'runEnd':!![]};await $[_0x17620e(0x111,'n#Cl')](parseInt($['waitTime']*0x1+0x1f4,0xa));async function _0x1fd324(_0x52ca43,_0xcff927){const _0x4e421f=_0x17620e;try{switch(_0x52ca43){case'mlproprice_skuOnceApply_jsf':if(_0xcff927[_0x4e421f(0x113,'PKS#')]===0x0&&_0xcff927[_0x4e421f(0x15e,'e3M8')]){if(_0xcff927[_0x4e421f(0x167,'%oTV')][_0x4e421f(0x118,'DofD')]===!![]&&_0xcff927[_0x4e421f(0x14b,'Rdb#')][_0x4e421f(0x159,'dxPE')]==='0'){let {succNum:succNum=0x0,succAmount:succAmount=0x0}=_0xcff927[_0x4e421f(0x135,'gE0g')];succAmount>0x0?(console[_0x4e421f(0x147,'KXr*')](_0x3a9a0e+_0x4e421f(0x17f,'DofD')+succNum+_0x4e421f(0x17b,'Xfox')+succAmount+'元'),_0x5c5453[_0x4e421f(0x151,'Tq8o')](_0x4e421f(0x15a,'pMJ[')+succNum+_0x4e421f(0x130,'M[!o')+succAmount+'元')):console[_0x4e421f(0x12a,'Rdb#')](_0x3a9a0e+_0x4e421f(0xfb,'PKS#'));}else _0xcff927['data'][_0x4e421f(0x168,'KXr*')]&&console[_0x4e421f(0x11f,'gE0g')](_0x3a9a0e+_0x4e421f(0x127,'w!CI')+_0xcff927[_0x4e421f(0x134,'YfzK')][_0x4e421f(0x168,'KXr*')]);}else console[_0x4e421f(0x12e,'Yx3M')](''+_0x3a9a0e+JSON['stringify'](_0xcff927));break;}}catch(_0x46c696){console[_0x4e421f(0x140,'cCqS')]('❌\x20未能正确处理\x20'+_0x52ca43+_0x4e421f(0x11a,'w!CI')+(_0x46c696[_0x4e421f(0x189,'t)JJ')]||_0x46c696));}}async function _0x2a1cdb(_0x13ab67){const _0x32e062=_0x17620e;if($[_0x32e062(0x142,'YV3]')])return;let _0x54e990='',_0x361041=null,_0x52372d=null,_0x10c0ef=_0x32e062(0x125,'YV3]'),_0x463f76={},_0x3d3449={};switch(_0x13ab67){case _0x32e062(0x10d,'M[!o'):_0x54e990=_0x32e062(0x160,'nGxG'),_0x52372d={'appid':'price_protection','functionId':'mlproprice_skuOnceApply_jsf','body':JSON[_0x32e062(0x100,'e3M8')]({'onceBatchId':'','couponConfirmFlag':null,'type':'25'}),'client':_0x32e062(0x16f,'%oTV'),'loginType':0x2,'h5st':'','t':Date[_0x32e062(0x179,'@@rR')]()};break;default:console['log'](_0x32e062(0x139,'e3M8')+_0x13ab67);return;}const _0x596b28={};_0x361041&&Object['assign'](_0x361041,_0x596b28);_0x52372d&&Object[_0x32e062(0x126,'wTLV')](_0x52372d,_0x596b28);const _0x31768d={'url':_0x54e990,'method':_0x10c0ef,'headers':{'origin':_0x32e062(0x138,'wL^7'),'Referer':_0x32e062(0x114,'wL^7'),'User-Agent':_0x3ea189,'Cookie':_0x5ad416,'x-rp-client':_0x32e062(0x102,'M[!o'),'accept':_0x32e062(0x149,'%oTV')},'params':_0x52372d,'data':_0x361041,'timeout':0x4e20};_0x10c0ef===_0x32e062(0x164,'nS6x')&&(delete _0x31768d['data'],delete _0x31768d['headers']['Content-Type']);const _0x2b9f84=0x1;let _0x1dbdae=0x0,_0x307a62=null,_0x49f979=![];while(_0x1dbdae<_0x2b9f84){const _0x26e883=await common[_0x32e062(0x157,'Xfox')](_0x31768d);if(!_0x26e883[_0x32e062(0x176,'Rdb#')]){_0x307a62=_0x32e062(0x15f,'@@rR')+_0x13ab67+'\x20请求失败\x20➜\x20'+_0x26e883[_0x32e062(0x143,'DofD')],_0x1dbdae++;continue;}if(!_0x26e883[_0x32e062(0x183,'cCqS')]){_0x307a62=_0x32e062(0x162,'DofD')+_0x13ab67+_0x32e062(0x121,'YjVf'),_0x1dbdae++;continue;}_0x1fd324(_0x13ab67,_0x26e883[_0x32e062(0x14e,'nS6x')]),_0x49f979=![];break;}_0x1dbdae>=_0x2b9f84&&(console[_0x32e062(0x185,'Tq8o')](_0x307a62),_0x49f979&&($[_0x32e062(0x107,'YfzK')]=!![]));}}
// prettier-ignore
function Env(t, e) { "undefined" != typeof process && JSON.stringify(process.env).indexOf("GITHUB") > -1 && process.exit(0); class s { constructor(t) { this.env = t } send(t, e = "GET") { t = "string" == typeof t ? { url: t } : t; let s = this.get; return "POST" === e && (s = this.post), new Promise((e, i) => { s.call(this, t, (t, s, r) => { t ? i(t) : e(s) }) }) } get(t) { return this.send.call(this.env, t) } post(t) { return this.send.call(this.env, t, "POST") } } return new class { constructor(t, e) { this.name = t, this.http = new s(this), this.data = null, this.dataFile = "box.dat", this.logs = [], this.isMute = !1, this.isNeedRewrite = !1, this.logSeparator = "\n", this.startTime = (new Date).getTime(), Object.assign(this, e), this.log("", `🔔${this.name}, 开始!`) } isNode() { return "undefined" != typeof module && !!module.exports } isQuanX() { return "undefined" != typeof $task } isSurge() { return "undefined" != typeof $httpClient && "undefined" == typeof $loon } isLoon() { return "undefined" != typeof $loon } toObj(t, e = null) { try { return JSON.parse(t) } catch { return e } } toStr(t, e = null) { try { return JSON.stringify(t) } catch { return e } } getjson(t, e) { let s = e; const i = this.getdata(t); if (i) try { s = JSON.parse(this.getdata(t)) } catch { } return s } setjson(t, e) { try { return this.setdata(JSON.stringify(t), e) } catch { return !1 } } getScript(t) { return new Promise(e => { this.get({ url: t }, (t, s, i) => e(i)) }) } runScript(t, e) { return new Promise(s => { let i = this.getdata("@chavy_boxjs_userCfgs.httpapi"); i = i ? i.replace(/\n/g, "").trim() : i; let r = this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout"); r = r ? 1 * r : 20, r = e && e.timeout ? e.timeout : r; const [o, h] = i.split("@"), n = { url: `http://${h}/v1/scripting/evaluate`, body: { script_text: t, mock_type: "cron", timeout: r }, headers: { "X-Key": o, Accept: "*/*" } }; this.post(n, (t, e, i) => s(i)) }).catch(t => this.logErr(t)) } loaddata() { if (!this.isNode()) return {}; { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e); if (!s && !i) return {}; { const i = s ? t : e; try { return JSON.parse(this.fs.readFileSync(i)) } catch (t) { return {} } } } } writedata() { if (this.isNode()) { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e), r = JSON.stringify(this.data); s ? this.fs.writeFileSync(t, r) : i ? this.fs.writeFileSync(e, r) : this.fs.writeFileSync(t, r) } } lodash_get(t, e, s) { const i = e.replace(/\[(\d+)\]/g, ".$1").split("."); let r = t; for (const t of i) if (r = Object(r)[t], void 0 === r) return s; return r } lodash_set(t, e, s) { return Object(t) !== t ? t : (Array.isArray(e) || (e = e.toString().match(/[^.[\]]+/g) || []), e.slice(0, -1).reduce((t, s, i) => Object(t[s]) === t[s] ? t[s] : t[s] = Math.abs(e[i + 1]) >> 0 == +e[i + 1] ? [] : {}, t)[e[e.length - 1]] = s, t) } getdata(t) { let e = this.getval(t); if (/^@/.test(t)) { const [, s, i] = /^@(.*?)\.(.*?)$/.exec(t), r = s ? this.getval(s) : ""; if (r) try { const t = JSON.parse(r); e = t ? this.lodash_get(t, i, "") : e } catch (t) { e = "" } } return e } setdata(t, e) { let s = !1; if (/^@/.test(e)) { const [, i, r] = /^@(.*?)\.(.*?)$/.exec(e), o = this.getval(i), h = i ? "null" === o ? null : o || "{}" : "{}"; try { const e = JSON.parse(h); this.lodash_set(e, r, t), s = this.setval(JSON.stringify(e), i) } catch (e) { const o = {}; this.lodash_set(o, r, t), s = this.setval(JSON.stringify(o), i) } } else s = this.setval(t, e); return s } getval(t) { return this.isSurge() || this.isLoon() ? $persistentStore.read(t) : this.isQuanX() ? $prefs.valueForKey(t) : this.isNode() ? (this.data = this.loaddata(), this.data[t]) : this.data && this.data[t] || null } setval(t, e) { return this.isSurge() || this.isLoon() ? $persistentStore.write(t, e) : this.isQuanX() ? $prefs.setValueForKey(t, e) : this.isNode() ? (this.data = this.loaddata(), this.data[e] = t, this.writedata(), !0) : this.data && this.data[e] || null } initGotEnv(t) { this.got = this.got ? this.got : require("got"), this.cktough = this.cktough ? this.cktough : require("tough-cookie"), this.ckjar = this.ckjar ? this.ckjar : new this.cktough.CookieJar, t && (t.headers = t.headers ? t.headers : {}, void 0 === t.headers.Cookie && void 0 === t.cookieJar && (t.cookieJar = this.ckjar)) } get(t, e = (() => { })) { t.headers && (delete t.headers["Content-Type"], delete t.headers["Content-Length"]), this.isSurge() || this.isLoon() ? (this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.get(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) })) : this.isQuanX() ? (this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t))) : this.isNode() && (this.initGotEnv(t), this.got(t).on("redirect", (t, e) => { try { if (t.headers["set-cookie"]) { const s = t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString(); s && this.ckjar.setCookieSync(s, null), e.cookieJar = this.ckjar } } catch (t) { this.logErr(t) } }).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) })) } post(t, e = (() => { })) { if (t.body && t.headers && !t.headers["Content-Type"] && (t.headers["Content-Type"] = "application/x-www-form-urlencoded"), t.headers && delete t.headers["Content-Length"], this.isSurge() || this.isLoon()) this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.post(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) }); else if (this.isQuanX()) t.method = "POST", this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t)); else if (this.isNode()) { this.initGotEnv(t); const { url: s, ...i } = t; this.got.post(s, i).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) }) } } time(t, e = null) { const s = e ? new Date(e) : new Date; let i = { "M+": s.getMonth() + 1, "d+": s.getDate(), "H+": s.getHours(), "m+": s.getMinutes(), "s+": s.getSeconds(), "q+": Math.floor((s.getMonth() + 3) / 3), S: s.getMilliseconds() }; /(y+)/.test(t) && (t = t.replace(RegExp.$1, (s.getFullYear() + "").substr(4 - RegExp.$1.length))); for (let e in i) new RegExp("(" + e + ")").test(t) && (t = t.replace(RegExp.$1, 1 == RegExp.$1.length ? i[e] : ("00" + i[e]).substr(("" + i[e]).length))); return t } msg(e = t, s = "", i = "", r) { const o = t => { if (!t) return t; if ("string" == typeof t) return this.isLoon() ? t : this.isQuanX() ? { "open-url": t } : this.isSurge() ? { url: t } : void 0; if ("object" == typeof t) { if (this.isLoon()) { let e = t.openUrl || t.url || t["open-url"], s = t.mediaUrl || t["media-url"]; return { openUrl: e, mediaUrl: s } } if (this.isQuanX()) { let e = t["open-url"] || t.url || t.openUrl, s = t["media-url"] || t.mediaUrl; return { "open-url": e, "media-url": s } } if (this.isSurge()) { let e = t.url || t.openUrl || t["open-url"]; return { url: e } } } }; if (this.isMute || (this.isSurge() || this.isLoon() ? $notification.post(e, s, i, o(r)) : this.isQuanX() && $notify(e, s, i, o(r))), !this.isMuteLog) { let t = ["", "==============📣系统通知📣=============="]; t.push(e), s && t.push(s), i && t.push(i), console.log(t.join("\n")), this.logs = this.logs.concat(t) } } log(...t) { t.length > 0 && (this.logs = [...this.logs, ...t]), console.log(t.join(this.logSeparator)) } logErr(t, e) { const s = !this.isSurge() && !this.isQuanX() && !this.isLoon(); s ? this.log("", `❗️${this.name}, 错误!`, t.stack) : this.log("", `❗️${this.name}, 错误!`, t) } wait(t) { return new Promise(e => setTimeout(e, t)) } done(t = {}) { const e = (new Date).getTime(), s = (e - this.startTime) / 1e3; this.log("", `🔔${this.name}, 结束! 🕛 ${s} 秒`), this.log(), (this.isSurge() || this.isQuanX() || this.isLoon()) && $done(t) } }(t, e) }
